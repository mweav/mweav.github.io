<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Higher Types — Categories with Families...in Agda!</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/agda.css" />
</head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../index.html">Higher Types</a>
            </div>
            <div id="navigation">
                <a href="../index.html">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Categories with Families...in Agda!</h1>

            <div class="post">
    Posted on February  8, 2016
    
      
        by <a href="mailto:mweav@sas.upenn.edu">Matthew Weaver</a>
      
    
</div>

<p>Here is a definition of categories with families I implemented in Agda. I wrote this using a neat category theory library.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> A category with families (CwF) is a categorical model of dependent type theory introduced by Peter Dybjer.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> Recently, they’ve been used with much success to model type theories with higher dimensional structures, such as higher dimensional equality,<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> an internalized computational interpretation of parametricity,<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> and a primative notion of names.<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a></p>
<!--more-->
<p>First, lets jump over the boring imports.</p>
<pre class="Agda"><code><a name="1641"></a><a name="1656" class="Keyword">module</a><a name="1662"> </a><a name="1663" href="#1" class="Module">CwF</a><a name="1666"> </a><a name="1667" class="Keyword">where</a><a name="1672">

</a><a name="1674" class="Keyword">open</a><a name="1678"> </a><a name="1679" class="Keyword">import</a><a name="1685"> </a><a name="1686" class="Module">prelude</a><a name="1693">
</a><a name="1694" class="Keyword">open</a><a name="1698"> </a><a name="1699" class="Keyword">import</a><a name="1705"> </a><a name="1706" class="Module">Level</a><a name="1711">
</a><a name="1712" class="Keyword">open</a><a name="1716"> </a><a name="1717" class="Keyword">import</a><a name="1723"> </a><a name="1724" class="Module">Categories.Category</a><a name="1743">
</a><a name="1744" class="Keyword">open</a><a name="1748"> </a><a name="1749" class="Keyword">import</a><a name="1755"> </a><a name="1756" class="Module">Categories.Functor</a><a name="1774"> </a><a name="1775" class="Keyword">renaming</a><a name="1783"> </a><a name="1784" class="Symbol">(</a><a name="1785">_≡_ </a><a name="1789" class="Symbol">to</a><a name="1791"> _==_</a><a name="1796" class="Symbol">;</a><a name="1797"> _∘_ </a><a name="1802" class="Symbol">to</a><a name="1804"> comp</a><a name="1809" class="Symbol">)</a><a name="1810">
</a><a name="1811" class="Keyword">open</a><a name="1815"> </a><a name="1816" class="Keyword">import</a><a name="1822"> </a><a name="1823" class="Module">Categories.Fam</a><a name="1837"> 
</a><a name="1839" class="Keyword">open</a><a name="1843"> </a><a name="1844" class="Keyword">import</a><a name="1850"> </a><a name="1851" class="Module">Categories.Presheaf</a><a name="1870">
</a><a name="1871" class="Keyword">open</a><a name="1875"> </a><a name="1876" class="Keyword">import</a><a name="1882"> </a><a name="1883" class="Module">Categories.Support.PropositionalEquality</a><a name="1923">

</a><a name="1925" class="Keyword">import</a><a name="1931"> </a><a name="1932" class="Module">Categories.Object.Terminal</a><a name="1958"> </a><a name="1959" class="Symbol">as</a><a name="1961"> </a><a name="1962" class="Module">Terminal</a></code></pre>
<p>As shown here in the type signature of <code>CwF</code>, a Category with Families is given by a category <code>C</code> and a functor <code>F: C</code><span class="math inline"><em></em><sup><em>o</em><em>p</em></sup></span> → <code>Fam</code>, where <code>Fam</code> is the category of families of sets. An equivalent way of describing <code>F</code> is as a <code>Fam</code> indexed presheaf over <code>C</code> (and hence the type of <code>F</code> is defined below as a <code>Presheaf</code> and not a <code>Functor</code>).</p>
<pre class="Agda"><code><a name="2324"></a><a name="2339" class="Keyword">record</a><a name="2345"> </a><a name="2346" href="#2346" class="Record">CwF</a><a name="2349"> </a><a name="2350" class="Symbol">{</a><a name="2351" href="#2351" class="Bound">o</a><a name="2352"> </a><a name="2353" href="#2353" class="Bound">ℓ</a><a name="2354"> </a><a name="2355" href="#2355" class="Bound">e</a><a name="2356"> </a><a name="2357" href="#2357" class="Bound">a</a><a name="2358"> </a><a name="2359" href="#2359" class="Bound">b</a><a name="2360"> </a><a name="2361" class="Symbol">:</a><a name="2362"> </a><a name="2363" class="Postulate">Level</a><a name="2368" class="Symbol">}</a><a name="2369">
       </a><a name="2377" class="Symbol">(</a><a name="2378" href="#2378" class="Bound">C</a><a name="2379"> </a><a name="2380" class="Symbol">:</a><a name="2381"> </a><a name="2382" class="Record">Category</a><a name="2390"> </a><a name="2391" href="#2351" class="Bound">o</a><a name="2392"> </a><a name="2393" href="#2353" class="Bound">ℓ</a><a name="2394"> </a><a name="2395" href="#2355" class="Bound">e</a><a name="2396" class="Symbol">)</a><a name="2397">
       </a><a name="2405" class="Symbol">(</a><a name="2406" href="#2406" class="Bound">F</a><a name="2407"> </a><a name="2408" class="Symbol">:</a><a name="2409"> </a><a name="2410" class="Function">Presheaf</a><a name="2418"> </a><a name="2419" href="#2378" class="Bound">C</a><a name="2420"> </a><a name="2421" class="Symbol">(</a><a name="2422" class="Function">Fam</a><a name="2425"> </a><a name="2426" href="#2357" class="Bound">a</a><a name="2427"> </a><a name="2428" href="#2359" class="Bound">b</a><a name="2429" class="Symbol">))</a><a name="2431">
       </a><a name="2439" class="Symbol">:</a><a name="2440"> </a><a name="2441" class="PrimitiveType">Set</a><a name="2444"> </a><a name="2445" class="Symbol">(</a><a name="2446" class="Primitive">suc</a><a name="2449"> </a><a name="2450" class="Symbol">(</a><a name="2451" href="#2351" class="Bound">o</a><a name="2452"> </a><a name="2453" class="Primitive Operator">⊔</a><a name="2454"> </a><a name="2455" href="#2353" class="Bound">ℓ</a><a name="2456"> </a><a name="2457" class="Primitive Operator">⊔</a><a name="2458"> </a><a name="2459" href="#2355" class="Bound">e</a><a name="2460"> </a><a name="2461" class="Primitive Operator">⊔</a><a name="2462"> </a><a name="2463" href="#2357" class="Bound">a</a><a name="2464"> </a><a name="2465" class="Primitive Operator">⊔</a><a name="2466"> </a><a name="2467" href="#2359" class="Bound">b</a><a name="2468" class="Symbol">))</a><a name="2470"> </a><a name="2471" class="Keyword">where</a><a name="2476">

  </a><a name="2480" class="Keyword">open</a><a name="2484"> </a><a name="2485" class="Module">Category</a><a name="2493"> </a><a name="2494" href="#2378" class="Bound">C</a><a name="2495"> </a><a name="2496" class="Keyword">renaming</a><a name="2504"> </a><a name="2505" class="Symbol">(</a><a name="2506">_≡_ </a><a name="2510" class="Symbol">to</a><a name="2512"> _≅_</a><a name="2516" class="Symbol">)</a><a name="2517">
  </a><a name="2520" class="Keyword">open</a><a name="2524"> </a><a name="2525" class="Module">Terminal</a><a name="2533"> </a><a name="2534" href="#2378" class="Bound">C</a><a name="2535">
  </a><a name="2538" class="Keyword">open</a><a name="2542"> </a><a name="2543" class="Module">Functor</a><a name="2550"> </a><a name="2551" href="#2406" class="Bound">F</a><a name="2552">
  </a><a name="2555" class="Keyword">open</a><a name="2559"> </a><a name="2560" class="Module">Fam</a><a name="2563"> </a><a name="2564" class="Keyword">renaming</a><a name="2572"> </a><a name="2573" class="Symbol">(</a><a name="2574">_≡_ </a><a name="2578" class="Symbol">to</a><a name="2580"> _==_</a><a name="2585" class="Symbol">;</a><a name="2586"> _∘_ </a><a name="2591" class="Symbol">to</a><a name="2593"> comp</a><a name="2598" class="Symbol">)</a><a name="2599">

  </a><a name="2603" class="Keyword">module</a><a name="2609"> </a><a name="2610" href="#2610" class="Module">C</a><a name="2611"> </a><a name="2612" class="Symbol">=</a><a name="2613"> </a><a name="2614" class="Module">Category</a><a name="2622"> </a><a name="2623" href="#2378" class="Bound">C</a><a name="2624">
  </a><a name="2627" class="Keyword">module</a><a name="2633"> </a><a name="2634" href="#2634" class="Module">F</a><a name="2635"> </a><a name="2636" class="Symbol">=</a><a name="2637"> </a><a name="2638" class="Module">Functor</a><a name="2645"> </a><a name="2646" href="#2406" class="Bound">F</a></code></pre>
<p>Given this basic categorical structure, we can now define the categorical interpretations for the various elements of a type system. The objects of the base category, <code>C</code>, will denote all of the contexts for the typing judgement. As such, we use <code>Ctx</code> to refer to the set of objects of <code>C</code> in our code.</p>
<pre class="Agda"><code><a name="2962">  </a><a name="2979" href="#2979" class="Bound">Ctx</a><a name="2982"> </a><a name="2983" class="Symbol">=</a><a name="2984"> </a><a name="2985" class="Function">C.Obj</a></code></pre>
<p>Thus, the morphisms of <code>C</code> are context substitutions. The set of all morphisms from <code>Δ</code> to <code>Γ</code> is written as <code>Subst Δ Γ</code> in Agda.</p>
<pre class="Agda"><code><a name="3132">  </a><a name="3149" href="#3149" class="Bound">Subst</a><a name="3154"> </a><a name="3155" class="Symbol">=</a><a name="3156"> </a><a name="3157" class="Function Operator">C._⇒_</a><a name="3162">


  </a><a name="3167" href="#3167" class="Bound">Id</a><a name="3169"> </a><a name="3170" class="Symbol">:</a><a name="3171"> </a><a name="3172" class="Symbol">{</a><a name="3173" href="#3173" class="Bound">Γ</a><a name="3174"> </a><a name="3175" class="Symbol">:</a><a name="3176"> </a><a name="3177" href="#2979" class="Bound">Ctx</a><a name="3180" class="Symbol">}</a><a name="3181"> </a><a name="3182" class="Symbol">→</a><a name="3183"> </a><a name="3184" href="#3149" class="Bound">Subst</a><a name="3189"> </a><a name="3190" href="#3173" class="Bound">Γ</a><a name="3191"> </a><a name="3192" href="#3173" class="Bound">Γ</a><a name="3193">
  </a><a name="3196" href="#3167" class="Function">Id</a><a name="3198"> </a><a name="3199" class="Symbol">=</a><a name="3200"> </a><a name="3201" class="Function">C.id</a></code></pre>
<p>Whenever we apply the functor <code>F</code> to some object of <code>C</code>, say <code>Γ</code>, the resulting object is a family of sets: <code>F(Γ) = (T, (B[A])</code><span class="math inline"><em></em><sub><em>A</em> ∈ <em>T</em></sub></span><code>)</code>. The set <code>T</code> represents the set of all types valid under context <code>Γ</code>, and the set <code>B[A]</code> contains all terms of type <code>A</code> valid under <code>Γ</code>. In Agda, we write <code>Ty Γ</code> for the set of types under <code>Γ</code>, and <code>Ter Γ A</code> for the terms of type <code>A</code> under <code>Γ</code>.</p>
<pre class="Agda"><code><a name="3603">  </a><a name="3620" href="#3620" class="Bound">Ty</a><a name="3622"> </a><a name="3623" class="Symbol">:</a><a name="3624"> </a><a name="3625" href="#2979" class="Bound">Ctx</a><a name="3628"> </a><a name="3629" class="Symbol">→</a><a name="3630"> </a><a name="3631" class="PrimitiveType">Set</a><a name="3634"> </a><a name="3635" class="Symbol">_</a><a name="3636">
  </a><a name="3639" href="#3620" class="Function">Ty</a><a name="3641"> </a><a name="3642" href="#3642" class="Bound">Γ</a><a name="3643"> </a><a name="3644" class="Symbol">=</a><a name="3645"> </a><a name="3646" class="Field">U</a><a name="3647"> </a><a name="3648" class="Symbol">(</a><a name="3649" class="Field">F.F₀</a><a name="3653"> </a><a name="3654" href="#3642" class="Bound">Γ</a><a name="3655" class="Symbol">)</a><a name="3656">


  </a><a name="3661" href="#3661" class="Bound">Ter</a><a name="3664"> </a><a name="3665" class="Symbol">:</a><a name="3666"> </a><a name="3667" class="Symbol">(</a><a name="3668" href="#3668" class="Bound">Γ</a><a name="3669"> </a><a name="3670" class="Symbol">:</a><a name="3671"> </a><a name="3672" href="#2979" class="Bound">Ctx</a><a name="3675" class="Symbol">)</a><a name="3676"> </a><a name="3677" class="Symbol">→</a><a name="3678"> </a><a name="3679" href="#3620" class="Bound">Ty</a><a name="3681"> </a><a name="3682" href="#3668" class="Bound">Γ</a><a name="3683"> </a><a name="3684" class="Symbol">→</a><a name="3685"> </a><a name="3686" class="PrimitiveType">Set</a><a name="3689"> </a><a name="3690" class="Symbol">_</a><a name="3691">
  </a><a name="3694" href="#3661" class="Function">Ter</a><a name="3697"> </a><a name="3698" href="#3698" class="Bound">Γ</a><a name="3699"> </a><a name="3700" href="#3700" class="Bound">A</a><a name="3701"> </a><a name="3702" class="Symbol">=</a><a name="3703"> </a><a name="3704" class="Symbol">(</a><a name="3705" class="Field">T</a><a name="3706"> </a><a name="3707" class="Symbol">(</a><a name="3708" class="Field">F.F₀</a><a name="3712"> </a><a name="3713" href="#3698" class="Bound">Γ</a><a name="3714" class="Symbol">))</a><a name="3716"> </a><a name="3717" href="#3700" class="Bound">A</a></code></pre>
<p>To make our syntax in Agda lighter, we define two operators, <code>TApp</code> and <code>tApp</code> that correspond to applying the action of a context substition through the functor <code>F</code> to types and terms, respectively.</p>
<pre class="Agda"><code><a name="3931">  </a><a name="3948" href="#3948" class="Bound">TApp</a><a name="3952"> </a><a name="3953" class="Symbol">:</a><a name="3954"> </a><a name="3955" class="Symbol">{</a><a name="3956" href="#3956" class="Bound">Δ</a><a name="3957"> </a><a name="3958" href="#3958" class="Bound">Γ</a><a name="3959"> </a><a name="3960" class="Symbol">:</a><a name="3961"> </a><a name="3962" href="#2979" class="Bound">Ctx</a><a name="3965" class="Symbol">}</a><a name="3966">
         </a><a name="3976" class="Symbol">(</a><a name="3977" href="#3977" class="Bound">σ</a><a name="3978">   </a><a name="3981" class="Symbol">:</a><a name="3982"> </a><a name="3983" href="#3149" class="Bound">Subst</a><a name="3988"> </a><a name="3989" href="#3956" class="Bound">Δ</a><a name="3990"> </a><a name="3991" href="#3958" class="Bound">Γ</a><a name="3992" class="Symbol">)</a><a name="3993">
         </a><a name="4003" class="Symbol">(</a><a name="4004" href="#4004" class="Bound">A</a><a name="4005">   </a><a name="4008" class="Symbol">:</a><a name="4009"> </a><a name="4010" href="#3620" class="Bound">Ty</a><a name="4012"> </a><a name="4013" href="#3958" class="Bound">Γ</a><a name="4014" class="Symbol">)</a><a name="4015">
         </a><a name="4025" class="Symbol">→</a><a name="4026"> </a><a name="4027" class="Comment">---------------</a><a name="4042">
         </a><a name="4052" href="#3620" class="Bound">Ty</a><a name="4054"> </a><a name="4055" href="#3956" class="Bound">Δ</a><a name="4056">
         
  </a><a name="4069" href="#3948" class="Function">TApp</a><a name="4073"> </a><a name="4074" href="#4074" class="Bound">σ</a><a name="4075"> </a><a name="4076" href="#4076" class="Bound">A</a><a name="4077"> </a><a name="4078" class="Symbol">=</a><a name="4079"> </a><a name="4080" class="Symbol">(</a><a name="4081" class="Field">Hom.f</a><a name="4086"> </a><a name="4087" class="Symbol">(</a><a name="4088" class="Field">F.F₁</a><a name="4092"> </a><a name="4093" href="#4074" class="Bound">σ</a><a name="4094" class="Symbol">))</a><a name="4096"> </a><a name="4097" href="#4076" class="Bound">A</a><a name="4098">


  </a><a name="4103" href="#4103" class="Bound">tApp</a><a name="4107"> </a><a name="4108" class="Symbol">:</a><a name="4109"> </a><a name="4110" class="Symbol">{</a><a name="4111" href="#4111" class="Bound">Δ</a><a name="4112"> </a><a name="4113" href="#4113" class="Bound">Γ</a><a name="4114"> </a><a name="4115" class="Symbol">:</a><a name="4116"> </a><a name="4117" href="#2979" class="Bound">Ctx</a><a name="4120" class="Symbol">}</a><a name="4121">
         </a><a name="4131" class="Symbol">(</a><a name="4132" href="#4132" class="Bound">σ</a><a name="4133">   </a><a name="4136" class="Symbol">:</a><a name="4137"> </a><a name="4138" href="#3149" class="Bound">Subst</a><a name="4143"> </a><a name="4144" href="#4111" class="Bound">Δ</a><a name="4145"> </a><a name="4146" href="#4113" class="Bound">Γ</a><a name="4147" class="Symbol">)</a><a name="4148">
         </a><a name="4158" class="Symbol">{</a><a name="4159" href="#4159" class="Bound">A</a><a name="4160">   </a><a name="4163" class="Symbol">:</a><a name="4164"> </a><a name="4165" href="#3620" class="Bound">Ty</a><a name="4167"> </a><a name="4168" href="#4113" class="Bound">Γ</a><a name="4169" class="Symbol">}</a><a name="4170">
         </a><a name="4180" class="Symbol">(</a><a name="4181" href="#4181" class="Bound">a</a><a name="4182">   </a><a name="4185" class="Symbol">:</a><a name="4186"> </a><a name="4187" href="#3661" class="Bound">Ter</a><a name="4190"> </a><a name="4191" href="#4113" class="Bound">Γ</a><a name="4192"> </a><a name="4193" href="#4159" class="Bound">A</a><a name="4194" class="Symbol">)</a><a name="4195">
         </a><a name="4205" class="Symbol">→</a><a name="4206"> </a><a name="4207" class="Comment">---------------</a><a name="4222">
         </a><a name="4232" href="#3661" class="Bound">Ter</a><a name="4235"> </a><a name="4236" href="#4111" class="Bound">Δ</a><a name="4237"> </a><a name="4238" class="Symbol">(</a><a name="4239" href="#3948" class="Bound">TApp</a><a name="4243"> </a><a name="4244" href="#4132" class="Bound">σ</a><a name="4245"> </a><a name="4246" href="#4159" class="Bound">A</a><a name="4247" class="Symbol">)</a><a name="4248">
         
  </a><a name="4261" href="#4103" class="Function">tApp</a><a name="4265"> </a><a name="4266" href="#4266" class="Bound">σ</a><a name="4267"> </a><a name="4268" class="Symbol">{</a><a name="4269" href="#4269" class="Bound">A</a><a name="4270" class="Symbol">}</a><a name="4271"> </a><a name="4272" href="#4272" class="Bound">a</a><a name="4273"> </a><a name="4274" class="Symbol">=</a><a name="4275"> </a><a name="4276" class="Symbol">(</a><a name="4277" class="Field">Hom.φ</a><a name="4282"> </a><a name="4283" class="Symbol">(</a><a name="4284" class="Field">F.F₁</a><a name="4288"> </a><a name="4289" href="#4266" class="Bound">σ</a><a name="4290" class="Symbol">))</a><a name="4292"> </a><a name="4293" href="#4269" class="Bound">A</a><a name="4294"> </a><a name="4295" href="#4272" class="Bound">a</a></code></pre>
<p>We first require the following equalities on our interpretation of types and terms. These all should actually be derivable from the categories library I’m using, but I have not yet taken the time to actually do so.</p>
<p>To explain a bit of the syntax and mechanics used to manipulate equality in the code that follows, <code>_≡_</code> is propositional equality, while <code>_≅_</code> is the equality of morphisms in a category. <code>ap</code> is the operation that pushes an equality through a function, as equality is applicative. The syntax <code>_≡[_]≡_</code> is heterogeneous equality where the middle term is a proof of equality between the types of the terms on either side. Lastly, <code>coe</code> coerces a term from one type to another given a proof the two types are equal.</p>
<pre class="Agda"><code><a name="5038">  </a><a name="5055" class="Keyword">field</a><a name="5060"> 
    </a><a name="5066" href="#5066" class="Field">TIdEq</a><a name="5071">     </a><a name="5076" class="Symbol">:</a><a name="5077"> </a><a name="5078" class="Symbol">{</a><a name="5079" href="#5079" class="Bound">Γ</a><a name="5080">     </a><a name="5085" class="Symbol">:</a><a name="5086"> </a><a name="5087" href="#2979" class="Bound">Ctx</a><a name="5090" class="Symbol">}</a><a name="5091">
                </a><a name="5108" class="Symbol">{</a><a name="5109" href="#5109" class="Bound">A</a><a name="5110">     </a><a name="5115" class="Symbol">:</a><a name="5116"> </a><a name="5117" href="#3620" class="Bound">Ty</a><a name="5119"> </a><a name="5120" href="#5079" class="Bound">Γ</a><a name="5121" class="Symbol">}</a><a name="5122">
                </a><a name="5139" class="Symbol">→</a><a name="5140"> </a><a name="5141" class="Comment">-------------------------------------------------</a><a name="5190">
                </a><a name="5207" href="#3948" class="Bound">TApp</a><a name="5211"> </a><a name="5212" href="#3167" class="Bound">Id</a><a name="5214"> </a><a name="5215" href="#5109" class="Bound">A</a><a name="5216"> </a><a name="5217" class="Datatype Operator">≡</a><a name="5218"> </a><a name="5219" href="#5109" class="Bound">A</a><a name="5220">

    </a><a name="5226" href="#5226" class="Field">TAppEq</a><a name="5232">    </a><a name="5236" class="Symbol">:</a><a name="5237"> </a><a name="5238" class="Symbol">{</a><a name="5239" href="#5239" class="Bound">Δ</a><a name="5240"> </a><a name="5241" href="#5241" class="Bound">Γ</a><a name="5242"> </a><a name="5243" href="#5243" class="Bound">Θ</a><a name="5244"> </a><a name="5245" class="Symbol">:</a><a name="5246"> </a><a name="5247" href="#2979" class="Bound">Ctx</a><a name="5250" class="Symbol">}</a><a name="5251">
                </a><a name="5268" class="Symbol">{</a><a name="5269" href="#5269" class="Bound">σ</a><a name="5270">     </a><a name="5275" class="Symbol">:</a><a name="5276"> </a><a name="5277" href="#3149" class="Bound">Subst</a><a name="5282"> </a><a name="5283" href="#5239" class="Bound">Δ</a><a name="5284"> </a><a name="5285" href="#5241" class="Bound">Γ</a><a name="5286" class="Symbol">}</a><a name="5287">               
                </a><a name="5319" class="Symbol">{</a><a name="5320" href="#5320" class="Bound">τ</a><a name="5321">     </a><a name="5326" class="Symbol">:</a><a name="5327"> </a><a name="5328" href="#3149" class="Bound">Subst</a><a name="5333"> </a><a name="5334" href="#5243" class="Bound">Θ</a><a name="5335"> </a><a name="5336" href="#5239" class="Bound">Δ</a><a name="5337" class="Symbol">}</a><a name="5338">
                </a><a name="5355" class="Symbol">{</a><a name="5356" href="#5356" class="Bound">A</a><a name="5357">     </a><a name="5362" class="Symbol">:</a><a name="5363"> </a><a name="5364" href="#3620" class="Bound">Ty</a><a name="5366"> </a><a name="5367" href="#5241" class="Bound">Γ</a><a name="5368" class="Symbol">}</a><a name="5369">
                </a><a name="5386" class="Symbol">→</a><a name="5387"> </a><a name="5388" class="Comment">-------------------------------------------------</a><a name="5437">
                </a><a name="5454" href="#3948" class="Bound">TApp</a><a name="5458"> </a><a name="5459" href="#5320" class="Bound">τ</a><a name="5460"> </a><a name="5461" class="Symbol">(</a><a name="5462" href="#3948" class="Bound">TApp</a><a name="5466"> </a><a name="5467" href="#5269" class="Bound">σ</a><a name="5468"> </a><a name="5469" href="#5356" class="Bound">A</a><a name="5470" class="Symbol">)</a><a name="5471"> </a><a name="5472" class="Datatype Operator">≡</a><a name="5473"> </a><a name="5474" href="#3948" class="Bound">TApp</a><a name="5478"> </a><a name="5479" class="Symbol">(</a><a name="5480" href="#5269" class="Bound">σ</a><a name="5481"> </a><a name="5482" class="Function Operator">∘</a><a name="5483"> </a><a name="5484" href="#5320" class="Bound">τ</a><a name="5485" class="Symbol">)</a><a name="5486"> </a><a name="5487" href="#5356" class="Bound">A</a><a name="5488">

    </a><a name="5494" href="#5494" class="Field">TAppAp</a><a name="5500">    </a><a name="5504" class="Symbol">:</a><a name="5505"> </a><a name="5506" class="Symbol">{</a><a name="5507" href="#5507" class="Bound">Δ</a><a name="5508"> </a><a name="5509" href="#5509" class="Bound">Γ</a><a name="5510">   </a><a name="5513" class="Symbol">:</a><a name="5514"> </a><a name="5515" href="#2979" class="Bound">Ctx</a><a name="5518" class="Symbol">}</a><a name="5519">
                </a><a name="5536" class="Symbol">{</a><a name="5537" href="#5537" class="Bound">σ</a><a name="5538">     </a><a name="5543" class="Symbol">:</a><a name="5544"> </a><a name="5545" href="#3149" class="Bound">Subst</a><a name="5550"> </a><a name="5551" href="#5507" class="Bound">Δ</a><a name="5552"> </a><a name="5553" href="#5509" class="Bound">Γ</a><a name="5554" class="Symbol">}</a><a name="5555">               
                </a><a name="5587" class="Symbol">{</a><a name="5588" href="#5588" class="Bound">τ</a><a name="5589">     </a><a name="5594" class="Symbol">:</a><a name="5595"> </a><a name="5596" href="#3149" class="Bound">Subst</a><a name="5601"> </a><a name="5602" href="#5507" class="Bound">Δ</a><a name="5603"> </a><a name="5604" href="#5509" class="Bound">Γ</a><a name="5605" class="Symbol">}</a><a name="5606">
                </a><a name="5623" class="Symbol">{</a><a name="5624" href="#5624" class="Bound">A</a><a name="5625">     </a><a name="5630" class="Symbol">:</a><a name="5631"> </a><a name="5632" href="#3620" class="Bound">Ty</a><a name="5634"> </a><a name="5635" href="#5509" class="Bound">Γ</a><a name="5636" class="Symbol">}</a><a name="5637">
                </a><a name="5654" class="Symbol">(</a><a name="5655" href="#5655" class="Bound">p</a><a name="5656">     </a><a name="5661" class="Symbol">:</a><a name="5662"> </a><a name="5663" href="#5537" class="Bound">σ</a><a name="5664"> </a><a name="5665" class="Function Operator">≅</a><a name="5666"> </a><a name="5667" href="#5588" class="Bound">τ</a><a name="5668" class="Symbol">)</a><a name="5669">
                </a><a name="5686" class="Symbol">→</a><a name="5687"> </a><a name="5688" class="Comment">-------------------------------------------------</a><a name="5737">
                </a><a name="5754" href="#3948" class="Bound">TApp</a><a name="5758"> </a><a name="5759" href="#5537" class="Bound">σ</a><a name="5760"> </a><a name="5761" href="#5624" class="Bound">A</a><a name="5762"> </a><a name="5763" class="Datatype Operator">≡</a><a name="5764"> </a><a name="5765" href="#3948" class="Bound">TApp</a><a name="5769"> </a><a name="5770" href="#5588" class="Bound">τ</a><a name="5771"> </a><a name="5772" href="#5624" class="Bound">A</a><a name="5773">

    </a><a name="5779" href="#5779" class="Field">tIdEq</a><a name="5784">     </a><a name="5789" class="Symbol">:</a><a name="5790"> </a><a name="5791" class="Symbol">{</a><a name="5792" href="#5792" class="Bound">Γ</a><a name="5793">     </a><a name="5798" class="Symbol">:</a><a name="5799"> </a><a name="5800" href="#2979" class="Bound">Ctx</a><a name="5803" class="Symbol">}</a><a name="5804">
                </a><a name="5821" class="Symbol">{</a><a name="5822" href="#5822" class="Bound">A</a><a name="5823">     </a><a name="5828" class="Symbol">:</a><a name="5829"> </a><a name="5830" href="#3620" class="Bound">Ty</a><a name="5832"> </a><a name="5833" href="#5792" class="Bound">Γ</a><a name="5834" class="Symbol">}</a><a name="5835">
                </a><a name="5852" class="Symbol">{</a><a name="5853" href="#5853" class="Bound">a</a><a name="5854">     </a><a name="5859" class="Symbol">:</a><a name="5860"> </a><a name="5861" href="#3661" class="Bound">Ter</a><a name="5864"> </a><a name="5865" href="#5792" class="Bound">Γ</a><a name="5866"> </a><a name="5867" href="#5822" class="Bound">A</a><a name="5868" class="Symbol">}</a><a name="5869">
                </a><a name="5886" class="Symbol">→</a><a name="5887"> </a><a name="5888" class="Comment">-------------------------------------------------</a><a name="5937">
                </a><a name="5954" href="#4103" class="Bound">tApp</a><a name="5958"> </a><a name="5959" href="#3167" class="Bound">Id</a><a name="5961"> </a><a name="5962" href="#5853" class="Bound">a</a><a name="5963">
                  </a><a name="5982" class="Function Operator">≡[</a><a name="5984"> </a><a name="5985" class="Function">ap</a><a name="5987"> </a><a name="5988" class="Symbol">(</a><a name="5989" href="#3661" class="Bound">Ter</a><a name="5992"> </a><a name="5993" href="#5792" class="Bound">Γ</a><a name="5994" class="Symbol">)</a><a name="5995"> </a><a name="5996" href="#5066" class="Bound">TIdEq</a><a name="6001"> </a><a name="6002" class="Function Operator">]≡</a><a name="6004">
                </a><a name="6021" href="#5853" class="Bound">a</a><a name="6022">

    </a><a name="6028" href="#6028" class="Field">tAppEq</a><a name="6034">    </a><a name="6038" class="Symbol">:</a><a name="6039"> </a><a name="6040" class="Symbol">{</a><a name="6041" href="#6041" class="Bound">Θ</a><a name="6042"> </a><a name="6043" href="#6043" class="Bound">Δ</a><a name="6044"> </a><a name="6045" href="#6045" class="Bound">Γ</a><a name="6046"> </a><a name="6047" class="Symbol">:</a><a name="6048"> </a><a name="6049" href="#2979" class="Bound">Ctx</a><a name="6052" class="Symbol">}</a><a name="6053">
                </a><a name="6070" class="Symbol">{</a><a name="6071" href="#6071" class="Bound">σ</a><a name="6072">     </a><a name="6077" class="Symbol">:</a><a name="6078"> </a><a name="6079" href="#3149" class="Bound">Subst</a><a name="6084"> </a><a name="6085" href="#6043" class="Bound">Δ</a><a name="6086"> </a><a name="6087" href="#6045" class="Bound">Γ</a><a name="6088" class="Symbol">}</a><a name="6089">               
                </a><a name="6121" class="Symbol">{</a><a name="6122" href="#6122" class="Bound">τ</a><a name="6123">     </a><a name="6128" class="Symbol">:</a><a name="6129"> </a><a name="6130" href="#3149" class="Bound">Subst</a><a name="6135"> </a><a name="6136" href="#6041" class="Bound">Θ</a><a name="6137"> </a><a name="6138" href="#6043" class="Bound">Δ</a><a name="6139" class="Symbol">}</a><a name="6140">
                </a><a name="6157" class="Symbol">{</a><a name="6158" href="#6158" class="Bound">A</a><a name="6159">     </a><a name="6164" class="Symbol">:</a><a name="6165"> </a><a name="6166" href="#3620" class="Bound">Ty</a><a name="6168"> </a><a name="6169" href="#6045" class="Bound">Γ</a><a name="6170" class="Symbol">}</a><a name="6171">
                </a><a name="6188" class="Symbol">{</a><a name="6189" href="#6189" class="Bound">a</a><a name="6190">     </a><a name="6195" class="Symbol">:</a><a name="6196"> </a><a name="6197" href="#3661" class="Bound">Ter</a><a name="6200"> </a><a name="6201" href="#6045" class="Bound">Γ</a><a name="6202"> </a><a name="6203" href="#6158" class="Bound">A</a><a name="6204" class="Symbol">}</a><a name="6205">
                </a><a name="6222" class="Symbol">→</a><a name="6223"> </a><a name="6224" class="Comment">-------------------------------------------------</a><a name="6273">
                </a><a name="6290" href="#4103" class="Bound">tApp</a><a name="6294"> </a><a name="6295" href="#6122" class="Bound">τ</a><a name="6296"> </a><a name="6297" class="Symbol">(</a><a name="6298" href="#4103" class="Bound">tApp</a><a name="6302"> </a><a name="6303" href="#6071" class="Bound">σ</a><a name="6304"> </a><a name="6305" href="#6189" class="Bound">a</a><a name="6306" class="Symbol">)</a><a name="6307">
                  </a><a name="6326" class="Function Operator">≡[</a><a name="6328"> </a><a name="6329" class="Function">ap</a><a name="6331"> </a><a name="6332" class="Symbol">(</a><a name="6333" href="#3661" class="Bound">Ter</a><a name="6336"> </a><a name="6337" href="#6041" class="Bound">Θ</a><a name="6338" class="Symbol">)</a><a name="6339"> </a><a name="6340" href="#5226" class="Bound">TAppEq</a><a name="6346"> </a><a name="6347" class="Function Operator">]≡</a><a name="6349">
                </a><a name="6366" href="#4103" class="Bound">tApp</a><a name="6370"> </a><a name="6371" class="Symbol">(</a><a name="6372" href="#6071" class="Bound">σ</a><a name="6373"> </a><a name="6374" class="Function Operator">∘</a><a name="6375"> </a><a name="6376" href="#6122" class="Bound">τ</a><a name="6377" class="Symbol">)</a><a name="6378"> </a><a name="6379" href="#6189" class="Bound">a</a><a name="6380">

    </a><a name="6386" href="#6386" class="Field">tAppAp</a><a name="6392">    </a><a name="6396" class="Symbol">:</a><a name="6397"> </a><a name="6398" class="Symbol">{</a><a name="6399" href="#6399" class="Bound">Δ</a><a name="6400"> </a><a name="6401" href="#6401" class="Bound">Γ</a><a name="6402">   </a><a name="6405" class="Symbol">:</a><a name="6406"> </a><a name="6407" href="#2979" class="Bound">Ctx</a><a name="6410" class="Symbol">}</a><a name="6411">
                </a><a name="6428" class="Symbol">{</a><a name="6429" href="#6429" class="Bound">σ</a><a name="6430">     </a><a name="6435" class="Symbol">:</a><a name="6436"> </a><a name="6437" href="#3149" class="Bound">Subst</a><a name="6442"> </a><a name="6443" href="#6399" class="Bound">Δ</a><a name="6444"> </a><a name="6445" href="#6401" class="Bound">Γ</a><a name="6446" class="Symbol">}</a><a name="6447">               
                </a><a name="6479" class="Symbol">{</a><a name="6480" href="#6480" class="Bound">τ</a><a name="6481">     </a><a name="6486" class="Symbol">:</a><a name="6487"> </a><a name="6488" href="#3149" class="Bound">Subst</a><a name="6493"> </a><a name="6494" href="#6399" class="Bound">Δ</a><a name="6495"> </a><a name="6496" href="#6401" class="Bound">Γ</a><a name="6497" class="Symbol">}</a><a name="6498">
                </a><a name="6515" class="Symbol">{</a><a name="6516" href="#6516" class="Bound">A</a><a name="6517">     </a><a name="6522" class="Symbol">:</a><a name="6523"> </a><a name="6524" href="#3620" class="Bound">Ty</a><a name="6526"> </a><a name="6527" href="#6401" class="Bound">Γ</a><a name="6528" class="Symbol">}</a><a name="6529">
                </a><a name="6546" class="Symbol">{</a><a name="6547" href="#6547" class="Bound">a</a><a name="6548">     </a><a name="6553" class="Symbol">:</a><a name="6554"> </a><a name="6555" href="#3661" class="Bound">Ter</a><a name="6558"> </a><a name="6559" href="#6401" class="Bound">Γ</a><a name="6560"> </a><a name="6561" href="#6516" class="Bound">A</a><a name="6562" class="Symbol">}</a><a name="6563">              
                </a><a name="6594" class="Symbol">(</a><a name="6595" href="#6595" class="Bound">p</a><a name="6596">     </a><a name="6601" class="Symbol">:</a><a name="6602"> </a><a name="6603" href="#6429" class="Bound">σ</a><a name="6604"> </a><a name="6605" class="Function Operator">≅</a><a name="6606"> </a><a name="6607" href="#6480" class="Bound">τ</a><a name="6608" class="Symbol">)</a><a name="6609">
                </a><a name="6626" class="Symbol">→</a><a name="6627"> </a><a name="6628" class="Comment">-------------------------------------------------</a><a name="6677">
                </a><a name="6694" href="#4103" class="Bound">tApp</a><a name="6698"> </a><a name="6699" href="#6429" class="Bound">σ</a><a name="6700"> </a><a name="6701" href="#6547" class="Bound">a</a><a name="6702">
                  </a><a name="6721" class="Function Operator">≡[</a><a name="6723"> </a><a name="6724" class="Function">ap</a><a name="6726"> </a><a name="6727" class="Symbol">(</a><a name="6728" href="#3661" class="Bound">Ter</a><a name="6731"> </a><a name="6732" href="#6399" class="Bound">Δ</a><a name="6733" class="Symbol">)</a><a name="6734"> </a><a name="6735" class="Symbol">(</a><a name="6736" href="#5494" class="Bound">TAppAp</a><a name="6742"> </a><a name="6743" href="#6595" class="Bound">p</a><a name="6744" class="Symbol">)</a><a name="6745"> </a><a name="6746" class="Function Operator">]≡</a><a name="6748">
                </a><a name="6765" href="#4103" class="Bound">tApp</a><a name="6769"> </a><a name="6770" href="#6480" class="Bound">τ</a><a name="6771"> </a><a name="6772" href="#6547" class="Bound">a</a></code></pre>
<p>The definition of a <code>CwF</code> is just a list of properties the previously described categorical structure must follow. These properties simply inforce a minimal description of a dependent type theory on the syntax we just described.</p>
<p>A <code>CwF</code> requires its base category, <code>C</code>, to have a terminal object here denoted by <code>[]</code>. Translated to type theory, this just means that the type system must have a unique empty context.</p>
<pre class="Agda"><code><a name="7202">    </a><a name="7221" href="#7221" class="Field">[]</a><a name="7223">        </a><a name="7231" class="Symbol">:</a><a name="7232"> </a><a name="7233" class="Record">Terminal</a></code></pre>
<p>Next, given an arbitrary context <code>Γ</code> and some type <code>A</code> well formed in <code>Γ</code>, there must be another context that extends <code>Γ</code> with a new variable of type <code>A</code>. We will write this extended context as <code>ctxExt Γ A</code>.</p>
<pre class="Agda"><code><a name="7461">    </a><a name="7480" href="#7480" class="Field">ctxExt</a><a name="7486">    </a><a name="7490" class="Symbol">:</a><a name="7491"> </a><a name="7492" class="Symbol">(</a><a name="7493" href="#7493" class="Bound">Γ</a><a name="7494"> </a><a name="7495" class="Symbol">:</a><a name="7496"> </a><a name="7497" href="#2979" class="Bound">Ctx</a><a name="7500" class="Symbol">)</a><a name="7501">
                </a><a name="7518" class="Symbol">(</a><a name="7519" href="#7519" class="Bound">A</a><a name="7520"> </a><a name="7521" class="Symbol">:</a><a name="7522"> </a><a name="7523" href="#3620" class="Bound">Ty</a><a name="7525"> </a><a name="7526" href="#7493" class="Bound">Γ</a><a name="7527" class="Symbol">)</a><a name="7528">
                </a><a name="7545" class="Symbol">→</a><a name="7546"> </a><a name="7547" class="Comment">-------------------------------------------------</a><a name="7596">
                </a><a name="7613" href="#2979" class="Bound">Ctx</a></code></pre>
<p>Now that we can extend contexts, we require our type theory to also permit weakening. Thus, we define <code>p</code> as the weakining substitution. Note that, as the functor <code>F</code> goes from <code>C</code><span class="math inline"><em></em><sup><em>o</em><em>p</em></sup></span> into <code>Fam</code>, it is contravariant in <code>C</code> and thus <code>p</code> goes from <code>ctxExt Γ A</code> to <code>Γ</code> so that the actual substition goes from <code>Γ</code> to <code>ctxExt Γ A</code> when it is applied to types and terms.</p>
<pre class="Agda"><code><a name="7997">    </a><a name="8029" href="#8029" class="Field">p</a><a name="8030">         </a><a name="8039" class="Symbol">:</a><a name="8040"> </a><a name="8041" class="Symbol">{</a><a name="8042" href="#8042" class="Bound">Γ</a><a name="8043"> </a><a name="8044" class="Symbol">:</a><a name="8045"> </a><a name="8046" href="#2979" class="Bound">Ctx</a><a name="8049" class="Symbol">}</a><a name="8050">
                </a><a name="8067" class="Symbol">{</a><a name="8068" href="#8068" class="Bound">A</a><a name="8069"> </a><a name="8070" class="Symbol">:</a><a name="8071"> </a><a name="8072" href="#3620" class="Bound">Ty</a><a name="8074"> </a><a name="8075" href="#8042" class="Bound">Γ</a><a name="8076" class="Symbol">}</a><a name="8077">
                </a><a name="8094" class="Symbol">→</a><a name="8095"> </a><a name="8096" class="Comment">-------------------------------------------------</a><a name="8145">
                </a><a name="8162" href="#3149" class="Bound">Subst</a><a name="8167"> </a><a name="8168" class="Symbol">(</a><a name="8169" href="#7480" class="Bound">ctxExt</a><a name="8175"> </a><a name="8176" href="#8042" class="Bound">Γ</a><a name="8177"> </a><a name="8178" href="#8068" class="Bound">A</a><a name="8179" class="Symbol">)</a><a name="8180"> </a><a name="8181" href="#8042" class="Bound">Γ</a></code></pre>
<p>When extending contexts, we also need a way to refer to the new variable that is added to the context; the term <code>q</code> represents this new term.</p>
<pre class="Agda"><code><a name="8336">    </a><a name="8355" href="#8355" class="Field">q</a><a name="8356">         </a><a name="8365" class="Symbol">:</a><a name="8366"> </a><a name="8367" class="Symbol">{</a><a name="8368" href="#8368" class="Bound">Γ</a><a name="8369"> </a><a name="8370" class="Symbol">:</a><a name="8371"> </a><a name="8372" href="#2979" class="Bound">Ctx</a><a name="8375" class="Symbol">}</a><a name="8376">
                </a><a name="8393" class="Symbol">{</a><a name="8394" href="#8394" class="Bound">A</a><a name="8395"> </a><a name="8396" class="Symbol">:</a><a name="8397"> </a><a name="8398" href="#3620" class="Bound">Ty</a><a name="8400"> </a><a name="8401" href="#8368" class="Bound">Γ</a><a name="8402" class="Symbol">}</a><a name="8403">
                </a><a name="8420" class="Symbol">→</a><a name="8421"> </a><a name="8422" class="Comment">-------------------------------------------------</a><a name="8471">
                </a><a name="8488" href="#3661" class="Bound">Ter</a><a name="8491"> </a><a name="8492" class="Symbol">(</a><a name="8493" href="#7480" class="Bound">ctxExt</a><a name="8499"> </a><a name="8500" href="#8368" class="Bound">Γ</a><a name="8501"> </a><a name="8502" href="#8394" class="Bound">A</a><a name="8503" class="Symbol">)</a><a name="8504"> </a><a name="8505" class="Symbol">(</a><a name="8506" href="#3948" class="Bound">TApp</a><a name="8510"> </a><a name="8511" class="Symbol">(</a><a name="8512" href="#8029" class="Bound">p</a><a name="8513"> </a><a name="8514" class="Symbol">{</a><a name="8515" href="#8368" class="Bound">Γ</a><a name="8516" class="Symbol">}</a><a name="8517"> </a><a name="8518" class="Symbol">{</a><a name="8519" href="#8394" class="Bound">A</a><a name="8520" class="Symbol">})</a><a name="8522"> </a><a name="8523" href="#8394" class="Bound">A</a><a name="8524" class="Symbol">)</a></code></pre>
<p>Lastly, for a substitution <code>σ</code> that takes types and terms from context <code>Γ</code> to <code>Δ</code>, a type <code>A</code> well formed in <code>Γ</code>, and some term <code>a</code> in <code>Δ</code> of type <code>TApp σ A</code> (i.e. type <code>A</code> with the substituion <code>σ</code> applied to it), we can define another substitution that takes in types and terms from <code>Γ</code> extended with a variable of type <code>A</code> to types and terms in the context <code>Δ</code>. While there are a number of moving parts defining the substitution, the idea is quite intuitive; if <code>σ</code> is way way to get from context <code>Γ</code> to <code>Δ</code>, and we know how to make a term <code>a</code> of type <code>A</code> in <code>Δ</code>, we can also get from <code>ctxExt Γ A</code> to <code>Δ</code> by using the original substitution <code>σ</code> for everything in <code>Γ</code>, and whenever the new variable of type <code>A</code> shows up, replacing it with the term <code>a</code> we provided. Note that the previous sentece ignores the action of the substitution <code>σ</code> on <code>A</code> for the sake of clarity.</p>
<pre class="Agda"><code><a name="9409">    </a><a name="9428" href="#9428" class="Field">uSubst</a><a name="9434">    </a><a name="9438" class="Symbol">:</a><a name="9439"> </a><a name="9440" class="Symbol">{</a><a name="9441" href="#9441" class="Bound">Δ</a><a name="9442"> </a><a name="9443" href="#9443" class="Bound">Γ</a><a name="9444"> </a><a name="9445" class="Symbol">:</a><a name="9446"> </a><a name="9447" href="#2979" class="Bound">Ctx</a><a name="9450" class="Symbol">}</a><a name="9451">
                </a><a name="9468" class="Symbol">(</a><a name="9469" href="#9469" class="Bound">σ</a><a name="9470">   </a><a name="9473" class="Symbol">:</a><a name="9474"> </a><a name="9475" href="#3149" class="Bound">Subst</a><a name="9480"> </a><a name="9481" href="#9441" class="Bound">Δ</a><a name="9482"> </a><a name="9483" href="#9443" class="Bound">Γ</a><a name="9484" class="Symbol">)</a><a name="9485">
                </a><a name="9502" class="Symbol">{</a><a name="9503" href="#9503" class="Bound">A</a><a name="9504">   </a><a name="9507" class="Symbol">:</a><a name="9508"> </a><a name="9509" href="#3620" class="Bound">Ty</a><a name="9511"> </a><a name="9512" href="#9443" class="Bound">Γ</a><a name="9513" class="Symbol">}</a><a name="9514">
                </a><a name="9531" class="Symbol">(</a><a name="9532" href="#9532" class="Bound">a</a><a name="9533">   </a><a name="9536" class="Symbol">:</a><a name="9537"> </a><a name="9538" href="#3661" class="Bound">Ter</a><a name="9541"> </a><a name="9542" href="#9441" class="Bound">Δ</a><a name="9543"> </a><a name="9544" class="Symbol">(</a><a name="9545" href="#3948" class="Bound">TApp</a><a name="9549"> </a><a name="9550" href="#9469" class="Bound">σ</a><a name="9551"> </a><a name="9552" href="#9503" class="Bound">A</a><a name="9553" class="Symbol">))</a><a name="9555">
                </a><a name="9572" class="Symbol">→</a><a name="9573"> </a><a name="9574" class="Comment">-------------------------------------------------</a><a name="9623">
                </a><a name="9640" href="#3149" class="Bound">Subst</a><a name="9645"> </a><a name="9646" href="#9441" class="Bound">Δ</a><a name="9647"> </a><a name="9648" class="Symbol">(</a><a name="9649" href="#7480" class="Bound">ctxExt</a><a name="9655"> </a><a name="9656" href="#9443" class="Bound">Γ</a><a name="9657"> </a><a name="9658" href="#9503" class="Bound">A</a><a name="9659" class="Symbol">)</a></code></pre>
<p>We require the following equalities involving <code>uSubst</code> to hold, which just .enforce that the type theoretic interpretations are consistent with the category theory.</p>
<p>If we use the <code>uSubst</code> rule to strengthen a substitution and immedietly weaken it, we end up with the same substitution we began with.</p>
<pre class="Agda"><code><a name="9973">    </a><a name="9992" href="#9992" class="Field">uEq₁</a><a name="9996">      </a><a name="10002" class="Symbol">:</a><a name="10003"> </a><a name="10004" class="Symbol">{</a><a name="10005" href="#10005" class="Bound">Δ</a><a name="10006"> </a><a name="10007" href="#10007" class="Bound">Γ</a><a name="10008"> </a><a name="10009" class="Symbol">:</a><a name="10010"> </a><a name="10011" href="#2979" class="Bound">Ctx</a><a name="10014" class="Symbol">}</a><a name="10015">
                </a><a name="10032" class="Symbol">(</a><a name="10033" href="#10033" class="Bound">σ</a><a name="10034">   </a><a name="10037" class="Symbol">:</a><a name="10038"> </a><a name="10039" href="#3149" class="Bound">Subst</a><a name="10044"> </a><a name="10045" href="#10005" class="Bound">Δ</a><a name="10046"> </a><a name="10047" href="#10007" class="Bound">Γ</a><a name="10048" class="Symbol">)</a><a name="10049">
                </a><a name="10066" class="Symbol">{</a><a name="10067" href="#10067" class="Bound">A</a><a name="10068">   </a><a name="10071" class="Symbol">:</a><a name="10072"> </a><a name="10073" href="#3620" class="Bound">Ty</a><a name="10075"> </a><a name="10076" href="#10007" class="Bound">Γ</a><a name="10077" class="Symbol">}</a><a name="10078">
                </a><a name="10095" class="Symbol">(</a><a name="10096" href="#10096" class="Bound">a</a><a name="10097">   </a><a name="10100" class="Symbol">:</a><a name="10101"> </a><a name="10102" href="#3661" class="Bound">Ter</a><a name="10105"> </a><a name="10106" href="#10005" class="Bound">Δ</a><a name="10107"> </a><a name="10108" class="Symbol">(</a><a name="10109" href="#3948" class="Bound">TApp</a><a name="10113"> </a><a name="10114" href="#10033" class="Bound">σ</a><a name="10115"> </a><a name="10116" href="#10067" class="Bound">A</a><a name="10117" class="Symbol">))</a><a name="10119">
                </a><a name="10136" class="Symbol">→</a><a name="10137"> </a><a name="10138" class="Comment">-------------------------------------------------</a><a name="10187">
                </a><a name="10204" href="#8029" class="Bound">p</a><a name="10205"> </a><a name="10206" class="Function Operator">∘</a><a name="10207"> </a><a name="10208" class="Symbol">(</a><a name="10209" href="#9428" class="Bound">uSubst</a><a name="10215"> </a><a name="10216" href="#10033" class="Bound">σ</a><a name="10217"> </a><a name="10218" href="#10096" class="Bound">a</a><a name="10219" class="Symbol">)</a><a name="10220"> </a><a name="10221" class="Function Operator">≅</a><a name="10222"> </a><a name="10223" href="#10033" class="Bound">σ</a></code></pre>
<p>If we use <code>uSubst</code> to strengthen the weakinging substitution by providing the variable of the extended context, we end up with the trivial substitution from the extended context to itself.</p>
<pre class="Agda"><code><a name="10425">    </a><a name="10444" href="#10444" class="Field">uEq₂</a><a name="10448">      </a><a name="10454" class="Symbol">:</a><a name="10455"> </a><a name="10456" class="Symbol">{</a><a name="10457" href="#10457" class="Bound">Γ</a><a name="10458"> </a><a name="10459" class="Symbol">:</a><a name="10460"> </a><a name="10461" href="#2979" class="Bound">Ctx</a><a name="10464" class="Symbol">}</a><a name="10465">
                </a><a name="10482" class="Symbol">{</a><a name="10483" href="#10483" class="Bound">A</a><a name="10484"> </a><a name="10485" class="Symbol">:</a><a name="10486"> </a><a name="10487" href="#3620" class="Bound">Ty</a><a name="10489"> </a><a name="10490" href="#10457" class="Bound">Γ</a><a name="10491" class="Symbol">}</a><a name="10492">
                </a><a name="10509" class="Symbol">→</a><a name="10510"> </a><a name="10511" class="Comment">-------------------------------------------------</a><a name="10560">
                </a><a name="10577" href="#9428" class="Bound">uSubst</a><a name="10583"> </a><a name="10584" class="Symbol">(</a><a name="10585" href="#8029" class="Bound">p</a><a name="10586"> </a><a name="10587" class="Symbol">{</a><a name="10588" href="#10457" class="Bound">Γ</a><a name="10589" class="Symbol">}</a><a name="10590"> </a><a name="10591" class="Symbol">{</a><a name="10592" href="#10483" class="Bound">A</a><a name="10593" class="Symbol">})</a><a name="10595"> </a><a name="10596" class="Symbol">(</a><a name="10597" href="#8355" class="Bound">q</a><a name="10598"> </a><a name="10599" class="Symbol">{</a><a name="10600" href="#10457" class="Bound">Γ</a><a name="10601" class="Symbol">}</a><a name="10602"> </a><a name="10603" class="Symbol">{</a><a name="10604" href="#10483" class="Bound">A</a><a name="10605" class="Symbol">})</a><a name="10607"> </a><a name="10608" class="Function Operator">≅</a><a name="10609"> </a><a name="10610" href="#3167" class="Bound">Id</a></code></pre>
<p>If we do another substitution <code>τ</code> after <code>uSubst σ a</code>, it is the same as the substitution given by applying <code>uSubst</code> to the composed substitution <code>σ ∘ τ</code> and the term given by applying <code>τ</code> to <code>a</code> .</p>
<pre class="Agda"><code><a name="10822">    </a><a name="10855" href="#10855" class="Field">uEq₃</a><a name="10859">      </a><a name="10865" class="Symbol">:</a><a name="10866"> </a><a name="10867" class="Symbol">{</a><a name="10868" href="#10868" class="Bound">Δ</a><a name="10869"> </a><a name="10870" href="#10870" class="Bound">Γ</a><a name="10871"> </a><a name="10872" href="#10872" class="Bound">Θ</a><a name="10873"> </a><a name="10874" class="Symbol">:</a><a name="10875"> </a><a name="10876" href="#2979" class="Bound">Ctx</a><a name="10879" class="Symbol">}</a><a name="10880">
                </a><a name="10897" class="Symbol">(</a><a name="10898" href="#10898" class="Bound">σ</a><a name="10899">     </a><a name="10904" class="Symbol">:</a><a name="10905"> </a><a name="10906" href="#3149" class="Bound">Subst</a><a name="10911"> </a><a name="10912" href="#10868" class="Bound">Δ</a><a name="10913"> </a><a name="10914" href="#10870" class="Bound">Γ</a><a name="10915" class="Symbol">)</a><a name="10916">
                </a><a name="10933" class="Symbol">{</a><a name="10934" href="#10934" class="Bound">A</a><a name="10935">     </a><a name="10940" class="Symbol">:</a><a name="10941"> </a><a name="10942" href="#3620" class="Bound">Ty</a><a name="10944"> </a><a name="10945" href="#10870" class="Bound">Γ</a><a name="10946" class="Symbol">}</a><a name="10947">
                </a><a name="10964" class="Symbol">(</a><a name="10965" href="#10965" class="Bound">a</a><a name="10966">     </a><a name="10971" class="Symbol">:</a><a name="10972"> </a><a name="10973" href="#3661" class="Bound">Ter</a><a name="10976"> </a><a name="10977" href="#10868" class="Bound">Δ</a><a name="10978"> </a><a name="10979" class="Symbol">(</a><a name="10980" href="#3948" class="Bound">TApp</a><a name="10984"> </a><a name="10985" href="#10898" class="Bound">σ</a><a name="10986"> </a><a name="10987" href="#10934" class="Bound">A</a><a name="10988" class="Symbol">))</a><a name="10990">
                </a><a name="11007" class="Symbol">(</a><a name="11008" href="#11008" class="Bound">τ</a><a name="11009">     </a><a name="11014" class="Symbol">:</a><a name="11015"> </a><a name="11016" href="#3149" class="Bound">Subst</a><a name="11021"> </a><a name="11022" href="#10872" class="Bound">Θ</a><a name="11023"> </a><a name="11024" href="#10868" class="Bound">Δ</a><a name="11025" class="Symbol">)</a><a name="11026">
                </a><a name="11043" class="Symbol">→</a><a name="11044"> </a><a name="11045" class="Comment">-------------------------------------------------</a><a name="11094">
                </a><a name="11111" class="Symbol">(</a><a name="11112" href="#9428" class="Bound">uSubst</a><a name="11118"> </a><a name="11119" href="#10898" class="Bound">σ</a><a name="11120"> </a><a name="11121" href="#10965" class="Bound">a</a><a name="11122" class="Symbol">)</a><a name="11123"> </a><a name="11124" class="Function Operator">∘</a><a name="11125"> </a><a name="11126" href="#11008" class="Bound">τ</a><a name="11127">
                  </a><a name="11146" class="Function Operator">≅</a><a name="11147">
                </a><a name="11164" href="#9428" class="Bound">uSubst</a><a name="11170"> </a><a name="11171" class="Symbol">(</a><a name="11172" href="#10898" class="Bound">σ</a><a name="11173"> </a><a name="11174" class="Function Operator">∘</a><a name="11175"> </a><a name="11176" href="#11008" class="Bound">τ</a><a name="11177" class="Symbol">)</a><a name="11178"> </a><a name="11179" class="Symbol">(</a><a name="11180" class="Function">coe</a><a name="11183"> </a><a name="11184" class="Symbol">(</a><a name="11185" class="Function">ap</a><a name="11187"> </a><a name="11188" class="Symbol">(</a><a name="11189" href="#3661" class="Bound">Ter</a><a name="11192"> </a><a name="11193" href="#10872" class="Bound">Θ</a><a name="11194" class="Symbol">)</a><a name="11195"> </a><a name="11196" href="#5226" class="Bound">TAppEq</a><a name="11202" class="Symbol">)</a><a name="11203"> </a><a name="11204" class="Symbol">(</a><a name="11205" href="#4103" class="Bound">tApp</a><a name="11209"> </a><a name="11210" href="#11008" class="Bound">τ</a><a name="11211"> </a><a name="11212" href="#10965" class="Bound">a</a><a name="11213" class="Symbol">))</a></code></pre>
<p>Lastly, when we apply <code>uSubst σ a</code> to the variable of the extended context, <code>q</code>, we get the term provided to <code>uSubst</code>, namely <code>a</code>. This is precisely what we expect based on the previous the explanation for what <code>uSubst</code> means. Unfortunately, Agda’s intensional type theory requires a lot of manual equality manipulation for this statement to type check.</p>
<pre class="Agda"><code><a name="11581">    </a><a name="11600" href="#11600" class="Field">uEq₄</a><a name="11604">      </a><a name="11610" class="Symbol">:</a><a name="11611"> </a><a name="11612" class="Symbol">{</a><a name="11613" href="#11613" class="Bound">Δ</a><a name="11614"> </a><a name="11615" href="#11615" class="Bound">Γ</a><a name="11616"> </a><a name="11617" class="Symbol">:</a><a name="11618"> </a><a name="11619" href="#2979" class="Bound">Ctx</a><a name="11622" class="Symbol">}</a><a name="11623">
                </a><a name="11640" class="Symbol">(</a><a name="11641" href="#11641" class="Bound">σ</a><a name="11642">   </a><a name="11645" class="Symbol">:</a><a name="11646"> </a><a name="11647" href="#3149" class="Bound">Subst</a><a name="11652"> </a><a name="11653" href="#11613" class="Bound">Δ</a><a name="11654"> </a><a name="11655" href="#11615" class="Bound">Γ</a><a name="11656" class="Symbol">)</a><a name="11657">
                </a><a name="11674" class="Symbol">{</a><a name="11675" href="#11675" class="Bound">A</a><a name="11676">   </a><a name="11679" class="Symbol">:</a><a name="11680"> </a><a name="11681" href="#3620" class="Bound">Ty</a><a name="11683"> </a><a name="11684" href="#11615" class="Bound">Γ</a><a name="11685" class="Symbol">}</a><a name="11686">
                </a><a name="11703" class="Symbol">(</a><a name="11704" href="#11704" class="Bound">a</a><a name="11705">   </a><a name="11708" class="Symbol">:</a><a name="11709"> </a><a name="11710" href="#3661" class="Bound">Ter</a><a name="11713"> </a><a name="11714" href="#11613" class="Bound">Δ</a><a name="11715"> </a><a name="11716" class="Symbol">(</a><a name="11717" href="#3948" class="Bound">TApp</a><a name="11721"> </a><a name="11722" href="#11641" class="Bound">σ</a><a name="11723"> </a><a name="11724" href="#11675" class="Bound">A</a><a name="11725" class="Symbol">))</a><a name="11727">
                </a><a name="11744" class="Symbol">→</a><a name="11745"> </a><a name="11746" class="Comment">-------------------------------------------------</a><a name="11795">
                </a><a name="11812" class="Function">coe</a><a name="11815"> </a><a name="11816" class="Symbol">(</a><a name="11817" class="Function">ap</a><a name="11819"> </a><a name="11820" class="Symbol">(</a><a name="11821" href="#3661" class="Bound">Ter</a><a name="11824"> </a><a name="11825" href="#11613" class="Bound">Δ</a><a name="11826" class="Symbol">)</a><a name="11827"> </a><a name="11828" href="#5226" class="Bound">TAppEq</a><a name="11834" class="Symbol">)</a><a name="11835"> </a><a name="11836" class="Symbol">(</a><a name="11837" href="#4103" class="Bound">tApp</a><a name="11841"> </a><a name="11842" class="Symbol">(</a><a name="11843" href="#9428" class="Bound">uSubst</a><a name="11849"> </a><a name="11850" href="#11641" class="Bound">σ</a><a name="11851"> </a><a name="11852" href="#11704" class="Bound">a</a><a name="11853" class="Symbol">)</a><a name="11854"> </a><a name="11855" href="#8355" class="Bound">q</a><a name="11856" class="Symbol">)</a><a name="11857">
                  </a><a name="11876" class="Function Operator">≡[</a><a name="11878"> </a><a name="11879" class="Function">ap</a><a name="11881"> </a><a name="11882" class="Symbol">(</a><a name="11883" href="#3661" class="Bound">Ter</a><a name="11886"> </a><a name="11887" href="#11613" class="Bound">Δ</a><a name="11888" class="Symbol">)</a><a name="11889"> </a><a name="11890" class="Symbol">(</a><a name="11891" href="#5494" class="Bound">TAppAp</a><a name="11897"> </a><a name="11898" class="Symbol">(</a><a name="11899" href="#9992" class="Bound">uEq₁</a><a name="11903"> </a><a name="11904" href="#11641" class="Bound">σ</a><a name="11905"> </a><a name="11906" href="#11704" class="Bound">a</a><a name="11907" class="Symbol">))</a><a name="11909"> </a><a name="11910" class="Function Operator">]≡</a><a name="11912">
                </a><a name="11929" href="#11704" class="Bound">a</a></code></pre>
<p>Note that, from the base definition of a <code>CwF</code>, the type theory only includes a notion of dependency and substitutions. This defnition can be extend with further restrictions that allow for it to model richer type systems, including Π-types, Σ-types, equality types, universes, and much more.</p>
<p>If you want to look at the definition of <code>CwF</code> without all of the intermittent text, view it in my GitHub <a href="https://github.com/mweav/Agda/blob/master/CwF.agda">here</a>!</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://github.com/copumpkin/categories">Dan Peebles, James Deikun, Andrea Vezzosi, James Cook, and other contributors. Categories library.,</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p><a href="http://www.cse.chalmers.se/~peterd/papers/InternalTT.pdf">Peter Dybjer. “Internal type theory.” 1995.</a><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p><a href="http://bora.uib.no/bitstream/handle/1956/10215/7.pdf?sequence=4&amp;isAllowed=y">Mark Bezem, Thierry Coquand, and Simon Huber. “A model of type theory in cubical sets.” 2013.</a><a href="#fnref3">↩</a></p></li>
<li id="fn4"><p><a href="http://publications.lib.chalmers.se/records/fulltext/230735/local_230735.pdf">Jean-Philippe Bernardy, Thierry Coquand, and Guilhem Moulin. “A presheaf model of parametric type theory.” 2015.</a><a href="#fnref4">↩</a></p></li>
<li id="fn5"><p><a href="https://www.repository.cam.ac.uk/bitstream/handle/1810/247863/Pitts_et_al-2015-Electronic_Notes_in_Theoretical_Computer_Science.pdf?sequence=1">Andrew Pitts, Justus Matthiesen, and Jasper Derikx. “A dependent type theory with abstractable names.” 2015.</a><a href="#fnref5">↩</a></p></li>
</ol>
</div>

<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = 'https://highertypes.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
