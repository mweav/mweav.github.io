<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Higher Types — Categories with Families...in Agda!</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/agda.css" />
</head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../index.html">Higher Types</a>
            </div>
            <div id="navigation">
                <a href="../index.html">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Categories with Families...in Agda!</h1>

            <div class="post">
    Posted on February  8, 2016
    
      
        by <a href="mailto:mweav@sas.upenn.edu">Matthew Weaver</a>
      
    
</div>

<p>Here is a definition of categories with families I implemented in Agda. I wrote this using a neat category theory library.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> A category with families (CwF) is a categorical model of dependent type theory introduced by Peter Dybjer.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> Recently, they’ve been used with much success to model type theories with higher dimensional structures, such as higher dimensional equality,<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> an internalized computational interpretation of parametricity,<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> and a primative notion of names.<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a></p>
<!--more-->
<p>First, lets jump over the boring imports.</p>
<pre class="Agda"><code><a name="1641"></a><a name="1656" class="Keyword">module</a><a name="1662"> </a><a name="1663" href="#1" class="Module">CwF</a><a name="1666"> </a><a name="1667" class="Keyword">where</a><a name="1672">

</a><a name="1674" class="Keyword">open</a><a name="1678"> </a><a name="1679" class="Keyword">import</a><a name="1685"> </a><a name="1686" class="Module">prelude</a><a name="1693">
</a><a name="1694" class="Keyword">open</a><a name="1698"> </a><a name="1699" class="Keyword">import</a><a name="1705"> </a><a name="1706" class="Module">Level</a><a name="1711">
</a><a name="1712" class="Keyword">open</a><a name="1716"> </a><a name="1717" class="Keyword">import</a><a name="1723"> </a><a name="1724" class="Module">Categories.Category</a><a name="1743">
</a><a name="1744" class="Keyword">open</a><a name="1748"> </a><a name="1749" class="Keyword">import</a><a name="1755"> </a><a name="1756" class="Module">Categories.Functor</a><a name="1774"> </a><a name="1775" class="Keyword">renaming</a><a name="1783"> </a><a name="1784" class="Symbol">(</a><a name="1785">_≡_ </a><a name="1789" class="Symbol">to</a><a name="1791"> _==_</a><a name="1796" class="Symbol">;</a><a name="1797"> _∘_ </a><a name="1802" class="Symbol">to</a><a name="1804"> comp</a><a name="1809" class="Symbol">)</a><a name="1810">
</a><a name="1811" class="Keyword">open</a><a name="1815"> </a><a name="1816" class="Keyword">import</a><a name="1822"> </a><a name="1823" class="Module">Categories.Fam</a><a name="1837"> 
</a><a name="1839" class="Keyword">open</a><a name="1843"> </a><a name="1844" class="Keyword">import</a><a name="1850"> </a><a name="1851" class="Module">Categories.Presheaf</a><a name="1870">
</a><a name="1871" class="Keyword">open</a><a name="1875"> </a><a name="1876" class="Keyword">import</a><a name="1882"> </a><a name="1883" class="Module">Categories.Support.PropositionalEquality</a><a name="1923">

</a><a name="1925" class="Keyword">import</a><a name="1931"> </a><a name="1932" class="Module">Categories.Object.Terminal</a><a name="1958"> </a><a name="1959" class="Symbol">as</a><a name="1961"> </a><a name="1962" class="Module">Terminal</a></code></pre>
<p>As shown here in the type signature of <code>CwF</code>, a Category with Families is given by a category <code>C</code> and a functor <code>F: C</code><span class="math inline"><em></em><sup><em>o</em><em>p</em></sup></span> → <code>Fam</code>, where <code>Fam</code> is the category of families of sets. An equivalent way of describing <code>F</code> is as a <code>Fam</code> indexed presheaf over <code>C</code> (and hence the type of <code>F</code> is defined below as a <code>Presheaf</code> and not a <code>Functor</code>).</p>
<pre class="Agda"><code><a name="2324"></a><a name="2339" class="Keyword">record</a><a name="2345"> </a><a name="2346" href="#2346" class="Record">CwF</a><a name="2349"> </a><a name="2350" class="Symbol">{</a><a name="2351" href="#2351" class="Bound">o</a><a name="2352"> </a><a name="2353" href="#2353" class="Bound">ℓ</a><a name="2354"> </a><a name="2355" href="#2355" class="Bound">e</a><a name="2356"> </a><a name="2357" href="#2357" class="Bound">a</a><a name="2358"> </a><a name="2359" href="#2359" class="Bound">b</a><a name="2360"> </a><a name="2361" class="Symbol">:</a><a name="2362"> </a><a name="2363" class="Postulate">Level</a><a name="2368" class="Symbol">}</a><a name="2369">
           </a><a name="2381" class="Symbol">(</a><a name="2382" href="#2382" class="Bound">C</a><a name="2383"> </a><a name="2384" class="Symbol">:</a><a name="2385"> </a><a name="2386" class="Record">Category</a><a name="2394"> </a><a name="2395" href="#2351" class="Bound">o</a><a name="2396"> </a><a name="2397" href="#2353" class="Bound">ℓ</a><a name="2398"> </a><a name="2399" href="#2355" class="Bound">e</a><a name="2400" class="Symbol">)</a><a name="2401">
           </a><a name="2413" class="Symbol">(</a><a name="2414" href="#2414" class="Bound">F</a><a name="2415"> </a><a name="2416" class="Symbol">:</a><a name="2417"> </a><a name="2418" class="Function">Presheaf</a><a name="2426"> </a><a name="2427" href="#2382" class="Bound">C</a><a name="2428"> </a><a name="2429" class="Symbol">(</a><a name="2430" class="Function">Fam</a><a name="2433"> </a><a name="2434" href="#2357" class="Bound">a</a><a name="2435"> </a><a name="2436" href="#2359" class="Bound">b</a><a name="2437" class="Symbol">))</a><a name="2439">
           </a><a name="2451" class="Symbol">:</a><a name="2452"> </a><a name="2453" class="PrimitiveType">Set</a><a name="2456"> </a><a name="2457" class="Symbol">(</a><a name="2458" class="Primitive">suc</a><a name="2461"> </a><a name="2462" class="Symbol">(</a><a name="2463" href="#2351" class="Bound">o</a><a name="2464"> </a><a name="2465" class="Primitive Operator">⊔</a><a name="2466"> </a><a name="2467" href="#2353" class="Bound">ℓ</a><a name="2468"> </a><a name="2469" class="Primitive Operator">⊔</a><a name="2470"> </a><a name="2471" href="#2355" class="Bound">e</a><a name="2472"> </a><a name="2473" class="Primitive Operator">⊔</a><a name="2474"> </a><a name="2475" href="#2357" class="Bound">a</a><a name="2476"> </a><a name="2477" class="Primitive Operator">⊔</a><a name="2478"> </a><a name="2479" href="#2359" class="Bound">b</a><a name="2480" class="Symbol">))</a><a name="2482"> </a><a name="2483" class="Keyword">where</a><a name="2488">

  </a><a name="2492" class="Keyword">open</a><a name="2496"> </a><a name="2497" class="Module">Category</a><a name="2505"> </a><a name="2506" href="#2382" class="Bound">C</a><a name="2507"> </a><a name="2508" class="Keyword">renaming</a><a name="2516"> </a><a name="2517" class="Symbol">(</a><a name="2518">_≡_ </a><a name="2522" class="Symbol">to</a><a name="2524"> _≅_</a><a name="2528" class="Symbol">)</a><a name="2529">
  </a><a name="2532" class="Keyword">open</a><a name="2536"> </a><a name="2537" class="Module">Terminal</a><a name="2545"> </a><a name="2546" href="#2382" class="Bound">C</a><a name="2547">
  </a><a name="2550" class="Keyword">open</a><a name="2554"> </a><a name="2555" class="Module">Functor</a><a name="2562"> </a><a name="2563" href="#2414" class="Bound">F</a><a name="2564">
  </a><a name="2567" class="Keyword">open</a><a name="2571"> </a><a name="2572" class="Module">Fam</a><a name="2575"> </a><a name="2576" class="Keyword">renaming</a><a name="2584"> </a><a name="2585" class="Symbol">(</a><a name="2586">_≡_ </a><a name="2590" class="Symbol">to</a><a name="2592"> _==_</a><a name="2597" class="Symbol">;</a><a name="2598"> _∘_ </a><a name="2603" class="Symbol">to</a><a name="2605"> comp</a><a name="2610" class="Symbol">)</a><a name="2611">

  </a><a name="2615" class="Keyword">module</a><a name="2621"> </a><a name="2622" href="#2622" class="Module">C</a><a name="2623"> </a><a name="2624" class="Symbol">=</a><a name="2625"> </a><a name="2626" class="Module">Category</a><a name="2634"> </a><a name="2635" href="#2382" class="Bound">C</a><a name="2636">
  </a><a name="2639" class="Keyword">module</a><a name="2645"> </a><a name="2646" href="#2646" class="Module">F</a><a name="2647"> </a><a name="2648" class="Symbol">=</a><a name="2649"> </a><a name="2650" class="Module">Functor</a><a name="2657"> </a><a name="2658" href="#2414" class="Bound">F</a></code></pre>
<p>Given this basic categorical structure, we can now define the categorical interpretations for the various elements of a type system. The objects of the base category, <code>C</code>, will denote all of the contexts for the typing judgement. As such, we use <code>Ctx</code> to refer to the set of objects of <code>C</code> in our code.</p>
<pre class="Agda"><code><a name="2974">  </a><a name="2991" href="#2991" class="Bound">Ctx</a><a name="2994"> </a><a name="2995" class="Symbol">=</a><a name="2996"> </a><a name="2997" class="Function">C.Obj</a></code></pre>
<p>Thus, the morphisms of <code>C</code> are context substitutions. The set of all morphisms from <code>Δ</code> to <code>Γ</code> is written as <code>Subst Δ Γ</code> in Agda.</p>
<pre class="Agda"><code><a name="3144">  </a><a name="3161" href="#3161" class="Bound">Subst</a><a name="3166"> </a><a name="3167" class="Symbol">=</a><a name="3168"> </a><a name="3169" class="Function Operator">C._⇒_</a><a name="3174">


  </a><a name="3179" href="#3179" class="Bound">Id</a><a name="3181"> </a><a name="3182" class="Symbol">:</a><a name="3183"> </a><a name="3184" class="Symbol">{</a><a name="3185" href="#3185" class="Bound">Γ</a><a name="3186"> </a><a name="3187" class="Symbol">:</a><a name="3188"> </a><a name="3189" href="#2991" class="Bound">Ctx</a><a name="3192" class="Symbol">}</a><a name="3193"> </a><a name="3194" class="Symbol">→</a><a name="3195"> </a><a name="3196" href="#3161" class="Bound">Subst</a><a name="3201"> </a><a name="3202" href="#3185" class="Bound">Γ</a><a name="3203"> </a><a name="3204" href="#3185" class="Bound">Γ</a><a name="3205">
  </a><a name="3208" href="#3179" class="Function">Id</a><a name="3210"> </a><a name="3211" class="Symbol">=</a><a name="3212"> </a><a name="3213" class="Function">C.id</a></code></pre>
<p>Whenever we apply the functor <code>F</code> to some object of <code>C</code>, say <code>Γ</code>, the resulting object is a family of sets: <code>F(Γ) = (T, (B[A])</code><span class="math inline"><em></em><sub><em>A</em> ∈ <em>T</em></sub></span><code>)</code>. The set <code>T</code> represents the set of all types valid under context <code>Γ</code>, and the set <code>B[A]</code> contains all terms of type <code>A</code> valid under <code>Γ</code>. In Agda, we write <code>Ty Γ</code> for the set of types under <code>Γ</code>, and <code>Ter Γ A</code> for the terms of type <code>A</code> under <code>Γ</code>.</p>
<pre class="Agda"><code><a name="3615">  </a><a name="3632" href="#3632" class="Bound">Ty</a><a name="3634"> </a><a name="3635" class="Symbol">:</a><a name="3636"> </a><a name="3637" href="#2991" class="Bound">Ctx</a><a name="3640"> </a><a name="3641" class="Symbol">→</a><a name="3642"> </a><a name="3643" class="PrimitiveType">Set</a><a name="3646"> </a><a name="3647" class="Symbol">_</a><a name="3648">
  </a><a name="3651" href="#3632" class="Function">Ty</a><a name="3653"> </a><a name="3654" href="#3654" class="Bound">Γ</a><a name="3655"> </a><a name="3656" class="Symbol">=</a><a name="3657"> </a><a name="3658" class="Field">U</a><a name="3659"> </a><a name="3660" class="Symbol">(</a><a name="3661" class="Field">F.F₀</a><a name="3665"> </a><a name="3666" href="#3654" class="Bound">Γ</a><a name="3667" class="Symbol">)</a><a name="3668">


  </a><a name="3673" href="#3673" class="Bound">Ter</a><a name="3676"> </a><a name="3677" class="Symbol">:</a><a name="3678"> </a><a name="3679" class="Symbol">(</a><a name="3680" href="#3680" class="Bound">Γ</a><a name="3681"> </a><a name="3682" class="Symbol">:</a><a name="3683"> </a><a name="3684" href="#2991" class="Bound">Ctx</a><a name="3687" class="Symbol">)</a><a name="3688"> </a><a name="3689" class="Symbol">→</a><a name="3690"> </a><a name="3691" href="#3632" class="Bound">Ty</a><a name="3693"> </a><a name="3694" href="#3680" class="Bound">Γ</a><a name="3695"> </a><a name="3696" class="Symbol">→</a><a name="3697"> </a><a name="3698" class="PrimitiveType">Set</a><a name="3701"> </a><a name="3702" class="Symbol">_</a><a name="3703">
  </a><a name="3706" href="#3673" class="Function">Ter</a><a name="3709"> </a><a name="3710" href="#3710" class="Bound">Γ</a><a name="3711"> </a><a name="3712" href="#3712" class="Bound">A</a><a name="3713"> </a><a name="3714" class="Symbol">=</a><a name="3715"> </a><a name="3716" class="Symbol">(</a><a name="3717" class="Field">T</a><a name="3718"> </a><a name="3719" class="Symbol">(</a><a name="3720" class="Field">F.F₀</a><a name="3724"> </a><a name="3725" href="#3710" class="Bound">Γ</a><a name="3726" class="Symbol">))</a><a name="3728"> </a><a name="3729" href="#3712" class="Bound">A</a></code></pre>
<p>To make our syntax in Agda lighter, we define two operators, <code>TApp</code> and <code>tApp</code> that correspond to applying the action of a context substition through the functor <code>F</code> to types and terms, respectively.</p>
<pre class="Agda"><code><a name="3943">  </a><a name="3960" href="#3960" class="Bound">TApp</a><a name="3964"> </a><a name="3965" class="Symbol">:</a><a name="3966"> </a><a name="3967" class="Symbol">{</a><a name="3968" href="#3968" class="Bound">Δ</a><a name="3969"> </a><a name="3970" href="#3970" class="Bound">Γ</a><a name="3971"> </a><a name="3972" class="Symbol">:</a><a name="3973"> </a><a name="3974" href="#2991" class="Bound">Ctx</a><a name="3977" class="Symbol">}</a><a name="3978">
         </a><a name="3988" class="Symbol">(</a><a name="3989" href="#3989" class="Bound">σ</a><a name="3990">   </a><a name="3993" class="Symbol">:</a><a name="3994"> </a><a name="3995" href="#3161" class="Bound">Subst</a><a name="4000"> </a><a name="4001" href="#3968" class="Bound">Δ</a><a name="4002"> </a><a name="4003" href="#3970" class="Bound">Γ</a><a name="4004" class="Symbol">)</a><a name="4005">
         </a><a name="4015" class="Symbol">(</a><a name="4016" href="#4016" class="Bound">A</a><a name="4017">   </a><a name="4020" class="Symbol">:</a><a name="4021"> </a><a name="4022" href="#3632" class="Bound">Ty</a><a name="4024"> </a><a name="4025" href="#3970" class="Bound">Γ</a><a name="4026" class="Symbol">)</a><a name="4027">
         </a><a name="4037" class="Symbol">→</a><a name="4038"> </a><a name="4039" class="Comment">---------------</a><a name="4054">
         </a><a name="4064" href="#3632" class="Bound">Ty</a><a name="4066"> </a><a name="4067" href="#3968" class="Bound">Δ</a><a name="4068">
         
  </a><a name="4081" href="#3960" class="Function">TApp</a><a name="4085"> </a><a name="4086" href="#4086" class="Bound">σ</a><a name="4087"> </a><a name="4088" href="#4088" class="Bound">A</a><a name="4089"> </a><a name="4090" class="Symbol">=</a><a name="4091"> </a><a name="4092" class="Symbol">(</a><a name="4093" class="Field">Hom.f</a><a name="4098"> </a><a name="4099" class="Symbol">(</a><a name="4100" class="Field">F.F₁</a><a name="4104"> </a><a name="4105" href="#4086" class="Bound">σ</a><a name="4106" class="Symbol">))</a><a name="4108"> </a><a name="4109" href="#4088" class="Bound">A</a><a name="4110">


  </a><a name="4115" href="#4115" class="Bound">tApp</a><a name="4119"> </a><a name="4120" class="Symbol">:</a><a name="4121"> </a><a name="4122" class="Symbol">{</a><a name="4123" href="#4123" class="Bound">Δ</a><a name="4124"> </a><a name="4125" href="#4125" class="Bound">Γ</a><a name="4126"> </a><a name="4127" class="Symbol">:</a><a name="4128"> </a><a name="4129" href="#2991" class="Bound">Ctx</a><a name="4132" class="Symbol">}</a><a name="4133">
         </a><a name="4143" class="Symbol">(</a><a name="4144" href="#4144" class="Bound">σ</a><a name="4145">   </a><a name="4148" class="Symbol">:</a><a name="4149"> </a><a name="4150" href="#3161" class="Bound">Subst</a><a name="4155"> </a><a name="4156" href="#4123" class="Bound">Δ</a><a name="4157"> </a><a name="4158" href="#4125" class="Bound">Γ</a><a name="4159" class="Symbol">)</a><a name="4160">
         </a><a name="4170" class="Symbol">{</a><a name="4171" href="#4171" class="Bound">A</a><a name="4172">   </a><a name="4175" class="Symbol">:</a><a name="4176"> </a><a name="4177" href="#3632" class="Bound">Ty</a><a name="4179"> </a><a name="4180" href="#4125" class="Bound">Γ</a><a name="4181" class="Symbol">}</a><a name="4182">
         </a><a name="4192" class="Symbol">(</a><a name="4193" href="#4193" class="Bound">a</a><a name="4194">   </a><a name="4197" class="Symbol">:</a><a name="4198"> </a><a name="4199" href="#3673" class="Bound">Ter</a><a name="4202"> </a><a name="4203" href="#4125" class="Bound">Γ</a><a name="4204"> </a><a name="4205" href="#4171" class="Bound">A</a><a name="4206" class="Symbol">)</a><a name="4207">
         </a><a name="4217" class="Symbol">→</a><a name="4218"> </a><a name="4219" class="Comment">---------------</a><a name="4234">
         </a><a name="4244" href="#3673" class="Bound">Ter</a><a name="4247"> </a><a name="4248" href="#4123" class="Bound">Δ</a><a name="4249"> </a><a name="4250" class="Symbol">(</a><a name="4251" href="#3960" class="Bound">TApp</a><a name="4255"> </a><a name="4256" href="#4144" class="Bound">σ</a><a name="4257"> </a><a name="4258" href="#4171" class="Bound">A</a><a name="4259" class="Symbol">)</a><a name="4260">
         
  </a><a name="4273" href="#4115" class="Function">tApp</a><a name="4277"> </a><a name="4278" href="#4278" class="Bound">σ</a><a name="4279"> </a><a name="4280" class="Symbol">{</a><a name="4281" href="#4281" class="Bound">A</a><a name="4282" class="Symbol">}</a><a name="4283"> </a><a name="4284" href="#4284" class="Bound">a</a><a name="4285"> </a><a name="4286" class="Symbol">=</a><a name="4287"> </a><a name="4288" class="Symbol">(</a><a name="4289" class="Field">Hom.φ</a><a name="4294"> </a><a name="4295" class="Symbol">(</a><a name="4296" class="Field">F.F₁</a><a name="4300"> </a><a name="4301" href="#4278" class="Bound">σ</a><a name="4302" class="Symbol">))</a><a name="4304"> </a><a name="4305" href="#4281" class="Bound">A</a><a name="4306"> </a><a name="4307" href="#4284" class="Bound">a</a></code></pre>
<p>We first require the following equalities on our interpretation of types and terms. These all should actually be derivable from the categories library I’m using, but I have not yet taken the time to actually do so.</p>
<p>To explain a bit of the syntax and mechanics used to manipulate equality in the code that follows, <code>_≡_</code> is propositional equality, while <code>_≅_</code> is the equality of morphisms in a category. <code>ap</code> is the operation that pushes an equality through a function, as equality is applicative. The syntax <code>_≡[_]≡_</code> is heterogeneous equality where the middle term is a proof of equality between the types of the terms on either side. Lastly, <code>coe</code> coerces a term from one type to another given a proof the two types are equal.</p>
<pre class="Agda"><code><a name="5050">  </a><a name="5067" class="Keyword">field</a><a name="5072"> 
    </a><a name="5078" href="#5078" class="Field">TIdEq</a><a name="5083">     </a><a name="5088" class="Symbol">:</a><a name="5089"> </a><a name="5090" class="Symbol">{</a><a name="5091" href="#5091" class="Bound">Γ</a><a name="5092">     </a><a name="5097" class="Symbol">:</a><a name="5098"> </a><a name="5099" href="#2991" class="Bound">Ctx</a><a name="5102" class="Symbol">}</a><a name="5103">
                </a><a name="5120" class="Symbol">{</a><a name="5121" href="#5121" class="Bound">A</a><a name="5122">     </a><a name="5127" class="Symbol">:</a><a name="5128"> </a><a name="5129" href="#3632" class="Bound">Ty</a><a name="5131"> </a><a name="5132" href="#5091" class="Bound">Γ</a><a name="5133" class="Symbol">}</a><a name="5134">
                </a><a name="5151" class="Symbol">→</a><a name="5152"> </a><a name="5153" class="Comment">-------------------------------------------------</a><a name="5202">
                </a><a name="5219" href="#3960" class="Bound">TApp</a><a name="5223"> </a><a name="5224" href="#3179" class="Bound">Id</a><a name="5226"> </a><a name="5227" href="#5121" class="Bound">A</a><a name="5228"> </a><a name="5229" class="Datatype Operator">≡</a><a name="5230"> </a><a name="5231" href="#5121" class="Bound">A</a><a name="5232">

    </a><a name="5238" href="#5238" class="Field">TAppEq</a><a name="5244">    </a><a name="5248" class="Symbol">:</a><a name="5249"> </a><a name="5250" class="Symbol">{</a><a name="5251" href="#5251" class="Bound">Δ</a><a name="5252"> </a><a name="5253" href="#5253" class="Bound">Γ</a><a name="5254"> </a><a name="5255" href="#5255" class="Bound">Θ</a><a name="5256"> </a><a name="5257" class="Symbol">:</a><a name="5258"> </a><a name="5259" href="#2991" class="Bound">Ctx</a><a name="5262" class="Symbol">}</a><a name="5263">
                </a><a name="5280" class="Symbol">{</a><a name="5281" href="#5281" class="Bound">σ</a><a name="5282">     </a><a name="5287" class="Symbol">:</a><a name="5288"> </a><a name="5289" href="#3161" class="Bound">Subst</a><a name="5294"> </a><a name="5295" href="#5251" class="Bound">Δ</a><a name="5296"> </a><a name="5297" href="#5253" class="Bound">Γ</a><a name="5298" class="Symbol">}</a><a name="5299">               
                </a><a name="5331" class="Symbol">{</a><a name="5332" href="#5332" class="Bound">τ</a><a name="5333">     </a><a name="5338" class="Symbol">:</a><a name="5339"> </a><a name="5340" href="#3161" class="Bound">Subst</a><a name="5345"> </a><a name="5346" href="#5255" class="Bound">Θ</a><a name="5347"> </a><a name="5348" href="#5251" class="Bound">Δ</a><a name="5349" class="Symbol">}</a><a name="5350">
                </a><a name="5367" class="Symbol">{</a><a name="5368" href="#5368" class="Bound">A</a><a name="5369">     </a><a name="5374" class="Symbol">:</a><a name="5375"> </a><a name="5376" href="#3632" class="Bound">Ty</a><a name="5378"> </a><a name="5379" href="#5253" class="Bound">Γ</a><a name="5380" class="Symbol">}</a><a name="5381">
                </a><a name="5398" class="Symbol">→</a><a name="5399"> </a><a name="5400" class="Comment">-------------------------------------------------</a><a name="5449">
                </a><a name="5466" href="#3960" class="Bound">TApp</a><a name="5470"> </a><a name="5471" href="#5332" class="Bound">τ</a><a name="5472"> </a><a name="5473" class="Symbol">(</a><a name="5474" href="#3960" class="Bound">TApp</a><a name="5478"> </a><a name="5479" href="#5281" class="Bound">σ</a><a name="5480"> </a><a name="5481" href="#5368" class="Bound">A</a><a name="5482" class="Symbol">)</a><a name="5483"> </a><a name="5484" class="Datatype Operator">≡</a><a name="5485"> </a><a name="5486" href="#3960" class="Bound">TApp</a><a name="5490"> </a><a name="5491" class="Symbol">(</a><a name="5492" href="#5281" class="Bound">σ</a><a name="5493"> </a><a name="5494" class="Function Operator">∘</a><a name="5495"> </a><a name="5496" href="#5332" class="Bound">τ</a><a name="5497" class="Symbol">)</a><a name="5498"> </a><a name="5499" href="#5368" class="Bound">A</a><a name="5500">

    </a><a name="5506" href="#5506" class="Field">TAppAp</a><a name="5512">    </a><a name="5516" class="Symbol">:</a><a name="5517"> </a><a name="5518" class="Symbol">{</a><a name="5519" href="#5519" class="Bound">Δ</a><a name="5520"> </a><a name="5521" href="#5521" class="Bound">Γ</a><a name="5522">   </a><a name="5525" class="Symbol">:</a><a name="5526"> </a><a name="5527" href="#2991" class="Bound">Ctx</a><a name="5530" class="Symbol">}</a><a name="5531">
                </a><a name="5548" class="Symbol">{</a><a name="5549" href="#5549" class="Bound">σ</a><a name="5550">     </a><a name="5555" class="Symbol">:</a><a name="5556"> </a><a name="5557" href="#3161" class="Bound">Subst</a><a name="5562"> </a><a name="5563" href="#5519" class="Bound">Δ</a><a name="5564"> </a><a name="5565" href="#5521" class="Bound">Γ</a><a name="5566" class="Symbol">}</a><a name="5567">               
                </a><a name="5599" class="Symbol">{</a><a name="5600" href="#5600" class="Bound">τ</a><a name="5601">     </a><a name="5606" class="Symbol">:</a><a name="5607"> </a><a name="5608" href="#3161" class="Bound">Subst</a><a name="5613"> </a><a name="5614" href="#5519" class="Bound">Δ</a><a name="5615"> </a><a name="5616" href="#5521" class="Bound">Γ</a><a name="5617" class="Symbol">}</a><a name="5618">
                </a><a name="5635" class="Symbol">{</a><a name="5636" href="#5636" class="Bound">A</a><a name="5637">     </a><a name="5642" class="Symbol">:</a><a name="5643"> </a><a name="5644" href="#3632" class="Bound">Ty</a><a name="5646"> </a><a name="5647" href="#5521" class="Bound">Γ</a><a name="5648" class="Symbol">}</a><a name="5649">
                </a><a name="5666" class="Symbol">(</a><a name="5667" href="#5667" class="Bound">p</a><a name="5668">     </a><a name="5673" class="Symbol">:</a><a name="5674"> </a><a name="5675" href="#5549" class="Bound">σ</a><a name="5676"> </a><a name="5677" class="Function Operator">≅</a><a name="5678"> </a><a name="5679" href="#5600" class="Bound">τ</a><a name="5680" class="Symbol">)</a><a name="5681">
                </a><a name="5698" class="Symbol">→</a><a name="5699"> </a><a name="5700" class="Comment">-------------------------------------------------</a><a name="5749">
                </a><a name="5766" href="#3960" class="Bound">TApp</a><a name="5770"> </a><a name="5771" href="#5549" class="Bound">σ</a><a name="5772"> </a><a name="5773" href="#5636" class="Bound">A</a><a name="5774"> </a><a name="5775" class="Datatype Operator">≡</a><a name="5776"> </a><a name="5777" href="#3960" class="Bound">TApp</a><a name="5781"> </a><a name="5782" href="#5600" class="Bound">τ</a><a name="5783"> </a><a name="5784" href="#5636" class="Bound">A</a><a name="5785">

    </a><a name="5791" href="#5791" class="Field">tIdEq</a><a name="5796">     </a><a name="5801" class="Symbol">:</a><a name="5802"> </a><a name="5803" class="Symbol">{</a><a name="5804" href="#5804" class="Bound">Γ</a><a name="5805">     </a><a name="5810" class="Symbol">:</a><a name="5811"> </a><a name="5812" href="#2991" class="Bound">Ctx</a><a name="5815" class="Symbol">}</a><a name="5816">
                </a><a name="5833" class="Symbol">{</a><a name="5834" href="#5834" class="Bound">A</a><a name="5835">     </a><a name="5840" class="Symbol">:</a><a name="5841"> </a><a name="5842" href="#3632" class="Bound">Ty</a><a name="5844"> </a><a name="5845" href="#5804" class="Bound">Γ</a><a name="5846" class="Symbol">}</a><a name="5847">
                </a><a name="5864" class="Symbol">{</a><a name="5865" href="#5865" class="Bound">a</a><a name="5866">     </a><a name="5871" class="Symbol">:</a><a name="5872"> </a><a name="5873" href="#3673" class="Bound">Ter</a><a name="5876"> </a><a name="5877" href="#5804" class="Bound">Γ</a><a name="5878"> </a><a name="5879" href="#5834" class="Bound">A</a><a name="5880" class="Symbol">}</a><a name="5881">
                </a><a name="5898" class="Symbol">→</a><a name="5899"> </a><a name="5900" class="Comment">-------------------------------------------------</a><a name="5949">
                </a><a name="5966" href="#4115" class="Bound">tApp</a><a name="5970"> </a><a name="5971" href="#3179" class="Bound">Id</a><a name="5973"> </a><a name="5974" href="#5865" class="Bound">a</a><a name="5975">
                  </a><a name="5994" class="Function Operator">≡[</a><a name="5996"> </a><a name="5997" class="Function">ap</a><a name="5999"> </a><a name="6000" class="Symbol">(</a><a name="6001" href="#3673" class="Bound">Ter</a><a name="6004"> </a><a name="6005" href="#5804" class="Bound">Γ</a><a name="6006" class="Symbol">)</a><a name="6007"> </a><a name="6008" href="#5078" class="Bound">TIdEq</a><a name="6013"> </a><a name="6014" class="Function Operator">]≡</a><a name="6016">
                </a><a name="6033" href="#5865" class="Bound">a</a><a name="6034">

    </a><a name="6040" href="#6040" class="Field">tAppEq</a><a name="6046">    </a><a name="6050" class="Symbol">:</a><a name="6051"> </a><a name="6052" class="Symbol">{</a><a name="6053" href="#6053" class="Bound">Θ</a><a name="6054"> </a><a name="6055" href="#6055" class="Bound">Δ</a><a name="6056"> </a><a name="6057" href="#6057" class="Bound">Γ</a><a name="6058"> </a><a name="6059" class="Symbol">:</a><a name="6060"> </a><a name="6061" href="#2991" class="Bound">Ctx</a><a name="6064" class="Symbol">}</a><a name="6065">
                </a><a name="6082" class="Symbol">{</a><a name="6083" href="#6083" class="Bound">σ</a><a name="6084">     </a><a name="6089" class="Symbol">:</a><a name="6090"> </a><a name="6091" href="#3161" class="Bound">Subst</a><a name="6096"> </a><a name="6097" href="#6055" class="Bound">Δ</a><a name="6098"> </a><a name="6099" href="#6057" class="Bound">Γ</a><a name="6100" class="Symbol">}</a><a name="6101">               
                </a><a name="6133" class="Symbol">{</a><a name="6134" href="#6134" class="Bound">τ</a><a name="6135">     </a><a name="6140" class="Symbol">:</a><a name="6141"> </a><a name="6142" href="#3161" class="Bound">Subst</a><a name="6147"> </a><a name="6148" href="#6053" class="Bound">Θ</a><a name="6149"> </a><a name="6150" href="#6055" class="Bound">Δ</a><a name="6151" class="Symbol">}</a><a name="6152">
                </a><a name="6169" class="Symbol">{</a><a name="6170" href="#6170" class="Bound">A</a><a name="6171">     </a><a name="6176" class="Symbol">:</a><a name="6177"> </a><a name="6178" href="#3632" class="Bound">Ty</a><a name="6180"> </a><a name="6181" href="#6057" class="Bound">Γ</a><a name="6182" class="Symbol">}</a><a name="6183">
                </a><a name="6200" class="Symbol">{</a><a name="6201" href="#6201" class="Bound">a</a><a name="6202">     </a><a name="6207" class="Symbol">:</a><a name="6208"> </a><a name="6209" href="#3673" class="Bound">Ter</a><a name="6212"> </a><a name="6213" href="#6057" class="Bound">Γ</a><a name="6214"> </a><a name="6215" href="#6170" class="Bound">A</a><a name="6216" class="Symbol">}</a><a name="6217">
                </a><a name="6234" class="Symbol">→</a><a name="6235"> </a><a name="6236" class="Comment">-------------------------------------------------</a><a name="6285">
                </a><a name="6302" href="#4115" class="Bound">tApp</a><a name="6306"> </a><a name="6307" href="#6134" class="Bound">τ</a><a name="6308"> </a><a name="6309" class="Symbol">(</a><a name="6310" href="#4115" class="Bound">tApp</a><a name="6314"> </a><a name="6315" href="#6083" class="Bound">σ</a><a name="6316"> </a><a name="6317" href="#6201" class="Bound">a</a><a name="6318" class="Symbol">)</a><a name="6319">
                  </a><a name="6338" class="Function Operator">≡[</a><a name="6340"> </a><a name="6341" class="Function">ap</a><a name="6343"> </a><a name="6344" class="Symbol">(</a><a name="6345" href="#3673" class="Bound">Ter</a><a name="6348"> </a><a name="6349" href="#6053" class="Bound">Θ</a><a name="6350" class="Symbol">)</a><a name="6351"> </a><a name="6352" href="#5238" class="Bound">TAppEq</a><a name="6358"> </a><a name="6359" class="Function Operator">]≡</a><a name="6361">
                </a><a name="6378" href="#4115" class="Bound">tApp</a><a name="6382"> </a><a name="6383" class="Symbol">(</a><a name="6384" href="#6083" class="Bound">σ</a><a name="6385"> </a><a name="6386" class="Function Operator">∘</a><a name="6387"> </a><a name="6388" href="#6134" class="Bound">τ</a><a name="6389" class="Symbol">)</a><a name="6390"> </a><a name="6391" href="#6201" class="Bound">a</a><a name="6392">

    </a><a name="6398" href="#6398" class="Field">tAppAp</a><a name="6404">    </a><a name="6408" class="Symbol">:</a><a name="6409"> </a><a name="6410" class="Symbol">{</a><a name="6411" href="#6411" class="Bound">Δ</a><a name="6412"> </a><a name="6413" href="#6413" class="Bound">Γ</a><a name="6414">   </a><a name="6417" class="Symbol">:</a><a name="6418"> </a><a name="6419" href="#2991" class="Bound">Ctx</a><a name="6422" class="Symbol">}</a><a name="6423">
                </a><a name="6440" class="Symbol">{</a><a name="6441" href="#6441" class="Bound">σ</a><a name="6442">     </a><a name="6447" class="Symbol">:</a><a name="6448"> </a><a name="6449" href="#3161" class="Bound">Subst</a><a name="6454"> </a><a name="6455" href="#6411" class="Bound">Δ</a><a name="6456"> </a><a name="6457" href="#6413" class="Bound">Γ</a><a name="6458" class="Symbol">}</a><a name="6459">               
                </a><a name="6491" class="Symbol">{</a><a name="6492" href="#6492" class="Bound">τ</a><a name="6493">     </a><a name="6498" class="Symbol">:</a><a name="6499"> </a><a name="6500" href="#3161" class="Bound">Subst</a><a name="6505"> </a><a name="6506" href="#6411" class="Bound">Δ</a><a name="6507"> </a><a name="6508" href="#6413" class="Bound">Γ</a><a name="6509" class="Symbol">}</a><a name="6510">
                </a><a name="6527" class="Symbol">{</a><a name="6528" href="#6528" class="Bound">A</a><a name="6529">     </a><a name="6534" class="Symbol">:</a><a name="6535"> </a><a name="6536" href="#3632" class="Bound">Ty</a><a name="6538"> </a><a name="6539" href="#6413" class="Bound">Γ</a><a name="6540" class="Symbol">}</a><a name="6541">
                </a><a name="6558" class="Symbol">{</a><a name="6559" href="#6559" class="Bound">a</a><a name="6560">     </a><a name="6565" class="Symbol">:</a><a name="6566"> </a><a name="6567" href="#3673" class="Bound">Ter</a><a name="6570"> </a><a name="6571" href="#6413" class="Bound">Γ</a><a name="6572"> </a><a name="6573" href="#6528" class="Bound">A</a><a name="6574" class="Symbol">}</a><a name="6575">              
                </a><a name="6606" class="Symbol">(</a><a name="6607" href="#6607" class="Bound">p</a><a name="6608">     </a><a name="6613" class="Symbol">:</a><a name="6614"> </a><a name="6615" href="#6441" class="Bound">σ</a><a name="6616"> </a><a name="6617" class="Function Operator">≅</a><a name="6618"> </a><a name="6619" href="#6492" class="Bound">τ</a><a name="6620" class="Symbol">)</a><a name="6621">
                </a><a name="6638" class="Symbol">→</a><a name="6639"> </a><a name="6640" class="Comment">-------------------------------------------------</a><a name="6689">
                </a><a name="6706" href="#4115" class="Bound">tApp</a><a name="6710"> </a><a name="6711" href="#6441" class="Bound">σ</a><a name="6712"> </a><a name="6713" href="#6559" class="Bound">a</a><a name="6714">
                  </a><a name="6733" class="Function Operator">≡[</a><a name="6735"> </a><a name="6736" class="Function">ap</a><a name="6738"> </a><a name="6739" class="Symbol">(</a><a name="6740" href="#3673" class="Bound">Ter</a><a name="6743"> </a><a name="6744" href="#6411" class="Bound">Δ</a><a name="6745" class="Symbol">)</a><a name="6746"> </a><a name="6747" class="Symbol">(</a><a name="6748" href="#5506" class="Bound">TAppAp</a><a name="6754"> </a><a name="6755" href="#6607" class="Bound">p</a><a name="6756" class="Symbol">)</a><a name="6757"> </a><a name="6758" class="Function Operator">]≡</a><a name="6760">
                </a><a name="6777" href="#4115" class="Bound">tApp</a><a name="6781"> </a><a name="6782" href="#6492" class="Bound">τ</a><a name="6783"> </a><a name="6784" href="#6559" class="Bound">a</a></code></pre>
<p>The definition of a <code>CwF</code> is just a list of properties the previously described categorical structure must follow. These properties simply inforce a minimal description of a dependent type theory on the syntax we just described.</p>
<p>A <code>CwF</code> requires its base category, <code>C</code>, to have a terminal object here denoted by <code>[]</code>. Translated to type theory, this just means that the type system must have a unique empty context.</p>
<pre class="Agda"><code><a name="7214">    </a><a name="7233" href="#7233" class="Field">[]</a><a name="7235">        </a><a name="7243" class="Symbol">:</a><a name="7244"> </a><a name="7245" class="Record">Terminal</a></code></pre>
<p>Next, given an arbitrary context <code>Γ</code> and some type <code>A</code> well formed in <code>Γ</code>, there must be another context that extends <code>Γ</code> with a new variable of type <code>A</code>. We will write this extended context as <code>ctxExt Γ A</code>.</p>
<pre class="Agda"><code><a name="7473">    </a><a name="7492" href="#7492" class="Field">ctxExt</a><a name="7498">    </a><a name="7502" class="Symbol">:</a><a name="7503"> </a><a name="7504" class="Symbol">(</a><a name="7505" href="#7505" class="Bound">Γ</a><a name="7506"> </a><a name="7507" class="Symbol">:</a><a name="7508"> </a><a name="7509" href="#2991" class="Bound">Ctx</a><a name="7512" class="Symbol">)</a><a name="7513">
                </a><a name="7530" class="Symbol">(</a><a name="7531" href="#7531" class="Bound">A</a><a name="7532"> </a><a name="7533" class="Symbol">:</a><a name="7534"> </a><a name="7535" href="#3632" class="Bound">Ty</a><a name="7537"> </a><a name="7538" href="#7505" class="Bound">Γ</a><a name="7539" class="Symbol">)</a><a name="7540">
                </a><a name="7557" class="Symbol">→</a><a name="7558"> </a><a name="7559" class="Comment">-------------------------------------------------</a><a name="7608">
                </a><a name="7625" href="#2991" class="Bound">Ctx</a></code></pre>
<p>Now that we can extend contexts, we require our type theory to also permit weakening. Thus, we define <code>p</code> as the weakining substitution. Note that, as the functor <code>F</code> goes from <code>C</code><span class="math inline"><em></em><sup><em>o</em><em>p</em></sup></span> into <code>Fam</code>, it is contravariant in <code>C</code> and thus <code>p</code> goes from <code>ctxExt Γ A</code> to <code>Γ</code> so that the actual substition goes from <code>Γ</code> to <code>ctxExt Γ A</code> when it is applied to types and terms.</p>
<pre class="Agda"><code><a name="8009">    </a><a name="8041" href="#8041" class="Field">p</a><a name="8042">         </a><a name="8051" class="Symbol">:</a><a name="8052"> </a><a name="8053" class="Symbol">{</a><a name="8054" href="#8054" class="Bound">Γ</a><a name="8055"> </a><a name="8056" class="Symbol">:</a><a name="8057"> </a><a name="8058" href="#2991" class="Bound">Ctx</a><a name="8061" class="Symbol">}</a><a name="8062">
                </a><a name="8079" class="Symbol">{</a><a name="8080" href="#8080" class="Bound">A</a><a name="8081"> </a><a name="8082" class="Symbol">:</a><a name="8083"> </a><a name="8084" href="#3632" class="Bound">Ty</a><a name="8086"> </a><a name="8087" href="#8054" class="Bound">Γ</a><a name="8088" class="Symbol">}</a><a name="8089">
                </a><a name="8106" class="Symbol">→</a><a name="8107"> </a><a name="8108" class="Comment">-------------------------------------------------</a><a name="8157">
                </a><a name="8174" href="#3161" class="Bound">Subst</a><a name="8179"> </a><a name="8180" class="Symbol">(</a><a name="8181" href="#7492" class="Bound">ctxExt</a><a name="8187"> </a><a name="8188" href="#8054" class="Bound">Γ</a><a name="8189"> </a><a name="8190" href="#8080" class="Bound">A</a><a name="8191" class="Symbol">)</a><a name="8192"> </a><a name="8193" href="#8054" class="Bound">Γ</a></code></pre>
<p>When extending contexts, we also need a way to refer to the new variable that is added to the context; the term <code>q</code> represents this new term.</p>
<pre class="Agda"><code><a name="8348">    </a><a name="8367" href="#8367" class="Field">q</a><a name="8368">         </a><a name="8377" class="Symbol">:</a><a name="8378"> </a><a name="8379" class="Symbol">{</a><a name="8380" href="#8380" class="Bound">Γ</a><a name="8381"> </a><a name="8382" class="Symbol">:</a><a name="8383"> </a><a name="8384" href="#2991" class="Bound">Ctx</a><a name="8387" class="Symbol">}</a><a name="8388">
                </a><a name="8405" class="Symbol">{</a><a name="8406" href="#8406" class="Bound">A</a><a name="8407"> </a><a name="8408" class="Symbol">:</a><a name="8409"> </a><a name="8410" href="#3632" class="Bound">Ty</a><a name="8412"> </a><a name="8413" href="#8380" class="Bound">Γ</a><a name="8414" class="Symbol">}</a><a name="8415">
                </a><a name="8432" class="Symbol">→</a><a name="8433"> </a><a name="8434" class="Comment">-------------------------------------------------</a><a name="8483">
                </a><a name="8500" href="#3673" class="Bound">Ter</a><a name="8503"> </a><a name="8504" class="Symbol">(</a><a name="8505" href="#7492" class="Bound">ctxExt</a><a name="8511"> </a><a name="8512" href="#8380" class="Bound">Γ</a><a name="8513"> </a><a name="8514" href="#8406" class="Bound">A</a><a name="8515" class="Symbol">)</a><a name="8516"> </a><a name="8517" class="Symbol">(</a><a name="8518" href="#3960" class="Bound">TApp</a><a name="8522"> </a><a name="8523" class="Symbol">(</a><a name="8524" href="#8041" class="Bound">p</a><a name="8525"> </a><a name="8526" class="Symbol">{</a><a name="8527" href="#8380" class="Bound">Γ</a><a name="8528" class="Symbol">}</a><a name="8529"> </a><a name="8530" class="Symbol">{</a><a name="8531" href="#8406" class="Bound">A</a><a name="8532" class="Symbol">})</a><a name="8534"> </a><a name="8535" href="#8406" class="Bound">A</a><a name="8536" class="Symbol">)</a></code></pre>
<p>Lastly, for a substitution <code>σ</code> that takes types and terms from context <code>Γ</code> to <code>Δ</code>, a type <code>A</code> well formed in <code>Γ</code>, and some term <code>a</code> in <code>Δ</code> of type <code>TApp σ A</code> (i.e. type <code>A</code> with the substituion <code>σ</code> applied to it), we can define another substitution that takes in types and terms from <code>Γ</code> extended with a variable of type <code>A</code> to types and terms in the context <code>Δ</code>. While there are a number of moving parts defining the substitution, the idea is quite intuitive; if <code>σ</code> is way way to get from context <code>Γ</code> to <code>Δ</code>, and we know how to make a term <code>a</code> of type <code>A</code> in <code>Δ</code>, we can also get from <code>ctxExt Γ A</code> to <code>Δ</code> by using the original substitution <code>σ</code> for everything in <code>Γ</code>, and whenever the new variable of type <code>A</code> shows up, replacing it with the term <code>a</code> we provided. Note that the previous sentece ignores the action of the substitution <code>σ</code> on <code>A</code> for the sake of clarity.</p>
<pre class="Agda"><code><a name="9421">    </a><a name="9440" href="#9440" class="Field">uSubst</a><a name="9446">    </a><a name="9450" class="Symbol">:</a><a name="9451"> </a><a name="9452" class="Symbol">{</a><a name="9453" href="#9453" class="Bound">Δ</a><a name="9454"> </a><a name="9455" href="#9455" class="Bound">Γ</a><a name="9456"> </a><a name="9457" class="Symbol">:</a><a name="9458"> </a><a name="9459" href="#2991" class="Bound">Ctx</a><a name="9462" class="Symbol">}</a><a name="9463">
                </a><a name="9480" class="Symbol">(</a><a name="9481" href="#9481" class="Bound">σ</a><a name="9482">   </a><a name="9485" class="Symbol">:</a><a name="9486"> </a><a name="9487" href="#3161" class="Bound">Subst</a><a name="9492"> </a><a name="9493" href="#9453" class="Bound">Δ</a><a name="9494"> </a><a name="9495" href="#9455" class="Bound">Γ</a><a name="9496" class="Symbol">)</a><a name="9497">
                </a><a name="9514" class="Symbol">{</a><a name="9515" href="#9515" class="Bound">A</a><a name="9516">   </a><a name="9519" class="Symbol">:</a><a name="9520"> </a><a name="9521" href="#3632" class="Bound">Ty</a><a name="9523"> </a><a name="9524" href="#9455" class="Bound">Γ</a><a name="9525" class="Symbol">}</a><a name="9526">
                </a><a name="9543" class="Symbol">(</a><a name="9544" href="#9544" class="Bound">a</a><a name="9545">   </a><a name="9548" class="Symbol">:</a><a name="9549"> </a><a name="9550" href="#3673" class="Bound">Ter</a><a name="9553"> </a><a name="9554" href="#9453" class="Bound">Δ</a><a name="9555"> </a><a name="9556" class="Symbol">(</a><a name="9557" href="#3960" class="Bound">TApp</a><a name="9561"> </a><a name="9562" href="#9481" class="Bound">σ</a><a name="9563"> </a><a name="9564" href="#9515" class="Bound">A</a><a name="9565" class="Symbol">))</a><a name="9567">
                </a><a name="9584" class="Symbol">→</a><a name="9585"> </a><a name="9586" class="Comment">-------------------------------------------------</a><a name="9635">
                </a><a name="9652" href="#3161" class="Bound">Subst</a><a name="9657"> </a><a name="9658" href="#9453" class="Bound">Δ</a><a name="9659"> </a><a name="9660" class="Symbol">(</a><a name="9661" href="#7492" class="Bound">ctxExt</a><a name="9667"> </a><a name="9668" href="#9455" class="Bound">Γ</a><a name="9669"> </a><a name="9670" href="#9515" class="Bound">A</a><a name="9671" class="Symbol">)</a></code></pre>
<p>We require the following equalities involving <code>uSubst</code> to hold, which just .enforce that the type theoretic interpretations are consistent with the category theory.</p>
<p>If we use the <code>uSubst</code> rule to strengthen a substitution and immedietly weaken it, we end up with the same substitution we began with.</p>
<pre class="Agda"><code><a name="9985">    </a><a name="10004" href="#10004" class="Field">uEq₁</a><a name="10008">      </a><a name="10014" class="Symbol">:</a><a name="10015"> </a><a name="10016" class="Symbol">{</a><a name="10017" href="#10017" class="Bound">Δ</a><a name="10018"> </a><a name="10019" href="#10019" class="Bound">Γ</a><a name="10020"> </a><a name="10021" class="Symbol">:</a><a name="10022"> </a><a name="10023" href="#2991" class="Bound">Ctx</a><a name="10026" class="Symbol">}</a><a name="10027">
                </a><a name="10044" class="Symbol">(</a><a name="10045" href="#10045" class="Bound">σ</a><a name="10046">   </a><a name="10049" class="Symbol">:</a><a name="10050"> </a><a name="10051" href="#3161" class="Bound">Subst</a><a name="10056"> </a><a name="10057" href="#10017" class="Bound">Δ</a><a name="10058"> </a><a name="10059" href="#10019" class="Bound">Γ</a><a name="10060" class="Symbol">)</a><a name="10061">
                </a><a name="10078" class="Symbol">{</a><a name="10079" href="#10079" class="Bound">A</a><a name="10080">   </a><a name="10083" class="Symbol">:</a><a name="10084"> </a><a name="10085" href="#3632" class="Bound">Ty</a><a name="10087"> </a><a name="10088" href="#10019" class="Bound">Γ</a><a name="10089" class="Symbol">}</a><a name="10090">
                </a><a name="10107" class="Symbol">(</a><a name="10108" href="#10108" class="Bound">a</a><a name="10109">   </a><a name="10112" class="Symbol">:</a><a name="10113"> </a><a name="10114" href="#3673" class="Bound">Ter</a><a name="10117"> </a><a name="10118" href="#10017" class="Bound">Δ</a><a name="10119"> </a><a name="10120" class="Symbol">(</a><a name="10121" href="#3960" class="Bound">TApp</a><a name="10125"> </a><a name="10126" href="#10045" class="Bound">σ</a><a name="10127"> </a><a name="10128" href="#10079" class="Bound">A</a><a name="10129" class="Symbol">))</a><a name="10131">
                </a><a name="10148" class="Symbol">→</a><a name="10149"> </a><a name="10150" class="Comment">-------------------------------------------------</a><a name="10199">
                </a><a name="10216" href="#8041" class="Bound">p</a><a name="10217"> </a><a name="10218" class="Function Operator">∘</a><a name="10219"> </a><a name="10220" class="Symbol">(</a><a name="10221" href="#9440" class="Bound">uSubst</a><a name="10227"> </a><a name="10228" href="#10045" class="Bound">σ</a><a name="10229"> </a><a name="10230" href="#10108" class="Bound">a</a><a name="10231" class="Symbol">)</a><a name="10232"> </a><a name="10233" class="Function Operator">≅</a><a name="10234"> </a><a name="10235" href="#10045" class="Bound">σ</a></code></pre>
<p>If we use <code>uSubst</code> to strengthen the weakinging substitution by providing the variable of the extended context, we end up with the trivial substitution from the extended context to itself.</p>
<pre class="Agda"><code><a name="10437">    </a><a name="10456" href="#10456" class="Field">uEq₂</a><a name="10460">      </a><a name="10466" class="Symbol">:</a><a name="10467"> </a><a name="10468" class="Symbol">{</a><a name="10469" href="#10469" class="Bound">Γ</a><a name="10470"> </a><a name="10471" class="Symbol">:</a><a name="10472"> </a><a name="10473" href="#2991" class="Bound">Ctx</a><a name="10476" class="Symbol">}</a><a name="10477">
                </a><a name="10494" class="Symbol">{</a><a name="10495" href="#10495" class="Bound">A</a><a name="10496"> </a><a name="10497" class="Symbol">:</a><a name="10498"> </a><a name="10499" href="#3632" class="Bound">Ty</a><a name="10501"> </a><a name="10502" href="#10469" class="Bound">Γ</a><a name="10503" class="Symbol">}</a><a name="10504">
                </a><a name="10521" class="Symbol">→</a><a name="10522"> </a><a name="10523" class="Comment">-------------------------------------------------</a><a name="10572">
                </a><a name="10589" href="#9440" class="Bound">uSubst</a><a name="10595"> </a><a name="10596" class="Symbol">(</a><a name="10597" href="#8041" class="Bound">p</a><a name="10598"> </a><a name="10599" class="Symbol">{</a><a name="10600" href="#10469" class="Bound">Γ</a><a name="10601" class="Symbol">}</a><a name="10602"> </a><a name="10603" class="Symbol">{</a><a name="10604" href="#10495" class="Bound">A</a><a name="10605" class="Symbol">})</a><a name="10607"> </a><a name="10608" class="Symbol">(</a><a name="10609" href="#8367" class="Bound">q</a><a name="10610"> </a><a name="10611" class="Symbol">{</a><a name="10612" href="#10469" class="Bound">Γ</a><a name="10613" class="Symbol">}</a><a name="10614"> </a><a name="10615" class="Symbol">{</a><a name="10616" href="#10495" class="Bound">A</a><a name="10617" class="Symbol">})</a><a name="10619"> </a><a name="10620" class="Function Operator">≅</a><a name="10621"> </a><a name="10622" href="#3179" class="Bound">Id</a></code></pre>
<p>If we do another substitution <code>τ</code> after <code>uSubst σ a</code>, it is the same as the substitution given by applying <code>uSubst</code> to the composed substitution <code>σ ∘ τ</code> and the term given by applying <code>τ</code> to <code>a</code> .</p>
<pre class="Agda"><code><a name="10834">    </a><a name="10867" href="#10867" class="Field">uEq₃</a><a name="10871">      </a><a name="10877" class="Symbol">:</a><a name="10878"> </a><a name="10879" class="Symbol">{</a><a name="10880" href="#10880" class="Bound">Δ</a><a name="10881"> </a><a name="10882" href="#10882" class="Bound">Γ</a><a name="10883"> </a><a name="10884" href="#10884" class="Bound">Θ</a><a name="10885"> </a><a name="10886" class="Symbol">:</a><a name="10887"> </a><a name="10888" href="#2991" class="Bound">Ctx</a><a name="10891" class="Symbol">}</a><a name="10892">
                </a><a name="10909" class="Symbol">(</a><a name="10910" href="#10910" class="Bound">σ</a><a name="10911">     </a><a name="10916" class="Symbol">:</a><a name="10917"> </a><a name="10918" href="#3161" class="Bound">Subst</a><a name="10923"> </a><a name="10924" href="#10880" class="Bound">Δ</a><a name="10925"> </a><a name="10926" href="#10882" class="Bound">Γ</a><a name="10927" class="Symbol">)</a><a name="10928">
                </a><a name="10945" class="Symbol">{</a><a name="10946" href="#10946" class="Bound">A</a><a name="10947">     </a><a name="10952" class="Symbol">:</a><a name="10953"> </a><a name="10954" href="#3632" class="Bound">Ty</a><a name="10956"> </a><a name="10957" href="#10882" class="Bound">Γ</a><a name="10958" class="Symbol">}</a><a name="10959">
                </a><a name="10976" class="Symbol">(</a><a name="10977" href="#10977" class="Bound">a</a><a name="10978">     </a><a name="10983" class="Symbol">:</a><a name="10984"> </a><a name="10985" href="#3673" class="Bound">Ter</a><a name="10988"> </a><a name="10989" href="#10880" class="Bound">Δ</a><a name="10990"> </a><a name="10991" class="Symbol">(</a><a name="10992" href="#3960" class="Bound">TApp</a><a name="10996"> </a><a name="10997" href="#10910" class="Bound">σ</a><a name="10998"> </a><a name="10999" href="#10946" class="Bound">A</a><a name="11000" class="Symbol">))</a><a name="11002">
                </a><a name="11019" class="Symbol">(</a><a name="11020" href="#11020" class="Bound">τ</a><a name="11021">     </a><a name="11026" class="Symbol">:</a><a name="11027"> </a><a name="11028" href="#3161" class="Bound">Subst</a><a name="11033"> </a><a name="11034" href="#10884" class="Bound">Θ</a><a name="11035"> </a><a name="11036" href="#10880" class="Bound">Δ</a><a name="11037" class="Symbol">)</a><a name="11038">
                </a><a name="11055" class="Symbol">→</a><a name="11056"> </a><a name="11057" class="Comment">-------------------------------------------------</a><a name="11106">
                </a><a name="11123" class="Symbol">(</a><a name="11124" href="#9440" class="Bound">uSubst</a><a name="11130"> </a><a name="11131" href="#10910" class="Bound">σ</a><a name="11132"> </a><a name="11133" href="#10977" class="Bound">a</a><a name="11134" class="Symbol">)</a><a name="11135"> </a><a name="11136" class="Function Operator">∘</a><a name="11137"> </a><a name="11138" href="#11020" class="Bound">τ</a><a name="11139">
                  </a><a name="11158" class="Function Operator">≅</a><a name="11159">
                </a><a name="11176" href="#9440" class="Bound">uSubst</a><a name="11182"> </a><a name="11183" class="Symbol">(</a><a name="11184" href="#10910" class="Bound">σ</a><a name="11185"> </a><a name="11186" class="Function Operator">∘</a><a name="11187"> </a><a name="11188" href="#11020" class="Bound">τ</a><a name="11189" class="Symbol">)</a><a name="11190"> </a><a name="11191" class="Symbol">(</a><a name="11192" class="Function">coe</a><a name="11195"> </a><a name="11196" class="Symbol">(</a><a name="11197" class="Function">ap</a><a name="11199"> </a><a name="11200" class="Symbol">(</a><a name="11201" href="#3673" class="Bound">Ter</a><a name="11204"> </a><a name="11205" href="#10884" class="Bound">Θ</a><a name="11206" class="Symbol">)</a><a name="11207"> </a><a name="11208" href="#5238" class="Bound">TAppEq</a><a name="11214" class="Symbol">)</a><a name="11215"> </a><a name="11216" class="Symbol">(</a><a name="11217" href="#4115" class="Bound">tApp</a><a name="11221"> </a><a name="11222" href="#11020" class="Bound">τ</a><a name="11223"> </a><a name="11224" href="#10977" class="Bound">a</a><a name="11225" class="Symbol">))</a></code></pre>
<p>Lastly, when we apply <code>uSubst σ a</code> to the variable of the extended context, <code>q</code>, we get the term provided to <code>uSubst</code>, namely <code>a</code>. This is precisely what we expect based on the previous the explanation for what <code>uSubst</code> means. Unfortunately, Agda’s intensional type theory requires a lot of manual equality manipulation for this statement to type check.</p>
<pre class="Agda"><code><a name="11593">    </a><a name="11612" href="#11612" class="Field">uEq₄</a><a name="11616">      </a><a name="11622" class="Symbol">:</a><a name="11623"> </a><a name="11624" class="Symbol">{</a><a name="11625" href="#11625" class="Bound">Δ</a><a name="11626"> </a><a name="11627" href="#11627" class="Bound">Γ</a><a name="11628"> </a><a name="11629" class="Symbol">:</a><a name="11630"> </a><a name="11631" href="#2991" class="Bound">Ctx</a><a name="11634" class="Symbol">}</a><a name="11635">
                </a><a name="11652" class="Symbol">(</a><a name="11653" href="#11653" class="Bound">σ</a><a name="11654">   </a><a name="11657" class="Symbol">:</a><a name="11658"> </a><a name="11659" href="#3161" class="Bound">Subst</a><a name="11664"> </a><a name="11665" href="#11625" class="Bound">Δ</a><a name="11666"> </a><a name="11667" href="#11627" class="Bound">Γ</a><a name="11668" class="Symbol">)</a><a name="11669">
                </a><a name="11686" class="Symbol">{</a><a name="11687" href="#11687" class="Bound">A</a><a name="11688">   </a><a name="11691" class="Symbol">:</a><a name="11692"> </a><a name="11693" href="#3632" class="Bound">Ty</a><a name="11695"> </a><a name="11696" href="#11627" class="Bound">Γ</a><a name="11697" class="Symbol">}</a><a name="11698">
                </a><a name="11715" class="Symbol">(</a><a name="11716" href="#11716" class="Bound">a</a><a name="11717">   </a><a name="11720" class="Symbol">:</a><a name="11721"> </a><a name="11722" href="#3673" class="Bound">Ter</a><a name="11725"> </a><a name="11726" href="#11625" class="Bound">Δ</a><a name="11727"> </a><a name="11728" class="Symbol">(</a><a name="11729" href="#3960" class="Bound">TApp</a><a name="11733"> </a><a name="11734" href="#11653" class="Bound">σ</a><a name="11735"> </a><a name="11736" href="#11687" class="Bound">A</a><a name="11737" class="Symbol">))</a><a name="11739">
                </a><a name="11756" class="Symbol">→</a><a name="11757"> </a><a name="11758" class="Comment">-------------------------------------------------</a><a name="11807">
                </a><a name="11824" class="Function">coe</a><a name="11827"> </a><a name="11828" class="Symbol">(</a><a name="11829" class="Function">ap</a><a name="11831"> </a><a name="11832" class="Symbol">(</a><a name="11833" href="#3673" class="Bound">Ter</a><a name="11836"> </a><a name="11837" href="#11625" class="Bound">Δ</a><a name="11838" class="Symbol">)</a><a name="11839"> </a><a name="11840" href="#5238" class="Bound">TAppEq</a><a name="11846" class="Symbol">)</a><a name="11847"> </a><a name="11848" class="Symbol">(</a><a name="11849" href="#4115" class="Bound">tApp</a><a name="11853"> </a><a name="11854" class="Symbol">(</a><a name="11855" href="#9440" class="Bound">uSubst</a><a name="11861"> </a><a name="11862" href="#11653" class="Bound">σ</a><a name="11863"> </a><a name="11864" href="#11716" class="Bound">a</a><a name="11865" class="Symbol">)</a><a name="11866"> </a><a name="11867" href="#8367" class="Bound">q</a><a name="11868" class="Symbol">)</a><a name="11869">
                  </a><a name="11888" class="Function Operator">≡[</a><a name="11890"> </a><a name="11891" class="Function">ap</a><a name="11893"> </a><a name="11894" class="Symbol">(</a><a name="11895" href="#3673" class="Bound">Ter</a><a name="11898"> </a><a name="11899" href="#11625" class="Bound">Δ</a><a name="11900" class="Symbol">)</a><a name="11901"> </a><a name="11902" class="Symbol">(</a><a name="11903" href="#5506" class="Bound">TAppAp</a><a name="11909"> </a><a name="11910" class="Symbol">(</a><a name="11911" href="#10004" class="Bound">uEq₁</a><a name="11915"> </a><a name="11916" href="#11653" class="Bound">σ</a><a name="11917"> </a><a name="11918" href="#11716" class="Bound">a</a><a name="11919" class="Symbol">))</a><a name="11921"> </a><a name="11922" class="Function Operator">]≡</a><a name="11924">
                </a><a name="11941" href="#11716" class="Bound">a</a></code></pre>
<p>Note that, from the base definition of a <code>CwF</code>, the type theory only includes a notion of dependency and substitutions. This defnition can be extend with further restrictions that allow for it to model richer type systems, including Π-types, Σ-types, equality types, universes, and much more.</p>
<p>If you want to look at the definition of <code>CwF</code> without all of the intermittent text, view it in my GitHub <a href="https://github.com/mweav/Agda/blob/master/CwF.agda">here</a>!</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://github.com/copumpkin/categories">Dan Peebles, James Deikun, Andrea Vezzosi, James Cook, and other contributors. Categories library.,</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p><a href="http://www.cse.chalmers.se/~peterd/papers/InternalTT.pdf">Peter Dybjer. “Internal type theory.” 1995.</a><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p><a href="http://bora.uib.no/bitstream/handle/1956/10215/7.pdf?sequence=4&amp;isAllowed=y">Mark Bezem, Thierry Coquand, and Simon Huber. “A model of type theory in cubical sets.” 2013.</a><a href="#fnref3">↩</a></p></li>
<li id="fn4"><p><a href="http://publications.lib.chalmers.se/records/fulltext/230735/local_230735.pdf">Jean-Philippe Bernardy, Thierry Coquand, and Guilhem Moulin. “A presheaf model of parametric type theory.” 2015.</a><a href="#fnref4">↩</a></p></li>
<li id="fn5"><p><a href="https://www.repository.cam.ac.uk/bitstream/handle/1810/247863/Pitts_et_al-2015-Electronic_Notes_in_Theoretical_Computer_Science.pdf?sequence=1">Andrew Pitts, Justus Matthiesen, and Jasper Derikx. “A dependent type theory with abstractable names.” 2015.</a><a href="#fnref5">↩</a></p></li>
</ol>
</div>

<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = 'https://highertypes.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
